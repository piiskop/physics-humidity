# Reeglid

## Jõud

```{=tex}
\begin{align}
\vec{F} := m \cdot \vec{a},
(\#eq:force)
\end{align}
```

kus *m* on mass ja *a* on kiirendus [@haynes_2014_crc, p. 2-2]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{M \cdot \frac{L}{T^2} = \frac{L \cdot M}{T^2}},
(\#eq:dimensional-analysis-for-force)
\end{align}
```

mistõttu ühik on $\unit{\meter\kilogram\per\second\squared}$ või lühemalt $\unit{\newton}$.

## Temperatuur


```{=tex}
\begin{align}
T := t + 237.15,
(\#eq:absolute-temperature)
\end{align}
```

mille ühik on $\unit{\kelvin}$ [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 8].

## Rõhk

```{=tex}
\begin{align}
p := \frac{F}{A} = \frac{m \cdot a}{A},
(\#eq:pressure)
\end{align}
```

kus *A* on pindala [@haynes_2014_crc, p. 2-2]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{L \cdot M}{T^2 \cdot L^2} = \frac{M}{T^2 \cdot L}},
(\#eq:dimensional-analysis-for-pressure)
\end{align}
```

mistõttu ühik on $\unit{\kilogram\per\second\squared\per\meter}$ või lühemalt $\unit{\pascal}$.


```{r label = "pressure"}
p <- 100e3
p_at <- 101.325e3
```

standardseisund
: määratletud olek (määratud temperatuur, rõhk, kontsentratsioon jne) termodünaamiliste funktsioonide tabeleerimiseks ja termodünaamiliste arvutuste tegemiseks [@haynes_2014_crc, p. 2-65]

Standardseisundi rõhk on `r p` $\unit{\pascal}$ [@haynes_2014_crc, p. 1-7]. Standardne atmosfäärirõhk on `r p_at` $\unit{\pascal}$ [@haynes_2014_crc, p. 6-12].

Ideaalse gaasi rõhk:
```{r label = "r"}
R <- 8314.472e-3
librarian::shelf("psychrolib")
T_0 <- GetTKelvinFromTCelsius(0)
T_1 <- GetTKelvinFromTCelsius(200)
```

```{=tex}
\begin{align}
p := \frac{n \cdot R \cdot T}{V},
(\#eq:pressure-of-ideal-gas)
\end{align}
```

milles *n* on ainehulk, *R* on universaalne gaasikonstant $`r R` \times \unit{\joule\per\mole\per\kelvin}$ ja *V* on ruumala [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 14]. Dimensionaalanalüüs:


```{=tex}
\begin{align}
\frac{\mathrm{N} \cdot \frac{\mathrm{L^2 \cdot M}}{\mathrm{T^2 \cdot N} \cdot \Theta} \cdot \Theta}{\mathrm{L^3}} = \mathrm{\frac{M}{L \cdot T^2}},
(\#eq:dimensional-analysis-for-pressure-of-ideal-gas)
\end{align}
```

mistõttu ühik on $\unit{\kilogram\per\meter\per\second\squared}$ ehk lühemalt $\unit{\pascal}$.
```{r label = "p-sat-of-liquid-h2o"}
T_p_sat <- 237.3 - T_0 # must be separated as used inside an equation

#' This function calculates the saturation vapor pressure.
#' 
#' @param T the absolute temperature
#' @param method the method of calculation: "ASHRAE" or "FAO"
#' 
#' @returns the saturation vapor pressure
calculate_p_sat <- function(T, method) {
  
  if (is.null(method)) {
    stop("The method must be either \"ASHRAE\" or \"FAO\". The method is currently not set.")
  } else if ("ASHRAE" == method) {
    
    for (index in 1:length(T)) {
    
      if (T[index] < 273.15 | T[index] > 473.15) {
        stop(paste("The absolute temperature must be between 273.15 and 473.15 K inclusive. The current absolute temperature at the position", index, "is", T[index], "K."))
      }
      
    }
  
    p_sat <- exp(-5.8002206e3 / T + 1.3914993 - 4.8640239e-2 * T + 4.1764768e-5 * T^2 - 1.4452093e-8 * T^3 + 6.5459673 * log(T))
  } else if ("FAO" == method) {
    p_sat <- 610.8 * exp((17.27 * (T - T_0)) / (T + T_p_sat))
  } else {
    stop(paste("The method must be either \"ASHRAE\" or \"FAO\". The method is currently", method, "."))
  }
  
  return(signif(p_sat, digits = 5))
}

```

Küllastusrõhk vedela vee kohal temperatuurivahemikus $\qty{`r T_0`}{\kelvin}$ kuni $\qty{`r T_1`}{\kelvin}$ on antud valemiga

```{=tex}

\begin{align}
& p_\text{sat} && := e^{\sum_{i := 8}^{n}{C_i \times T^{i - 9}} + 6.5459673 \times \mathrm{ln}(T)}\\
&&&= e^{\sum_{i := 8}^n{C_i \times (t + 273.15)^{i - 9}} + 6.5459673 \times \mathrm{ln}(t + 273.15)}\text{, kus}\\
& C_8 && := -5.8002206 \times 10^3,\\
& C_9 && := 1.3914993,\\
& C_{10} && := -4.8640239 \times 10^{-2},\\
& C_{11} && := 4.1764768 \times 10^{-5},\\
& C_{12} && := -1.4452093 \times 10^{-8}
(\#eq:saturation-pressure-over-liquid-h2o)
\end{align}

```

milles *T* on absoluutne temperatuur [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 14]. [@inbook, p. 37] on esitatud teistsugune valem küllastusrõhu arvutamiseks:

```{=tex}

\begin{align}
p_\text{sat} := 610.8 \times e^\frac{17.27 \times (T - \qty{`r T_0`}{\kelvin})}{T - \qty{`r T_0`}{\kelvin} + \qty{237.3}{\kelvin}} \times \unit{\pascal} = 610.8 \times e^\frac{17.27 \times (T - \qty{`r T_0`}{\kelvin})}{T + \qty{`r T_p_sat`}{\kelvin}} \times \unit{\pascal}.
(\#eq:saturation-pressure-in-inbook)
\end{align}

```

## Energia, töö, soojushulk


```{=tex}
\begin{align}
E := \int{\vec{F}} \cdot \mathrm{d}(s) = \int{m \cdot \vec{a}} \cdot \mathrm{d}(s),
(\#eq:energy)
\end{align}
```

milles $\mathrm{d}(s)$ on lõputult väike nihe [@haynes_2014_crc, p. 2-2]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{L \cdot M}{T^2} \cdot L = \frac{L^2 \cdot M}{T^2}},
(\#eq:dimensional-analysis-for-energy)
\end{align}
```

mistõttu ühik on $\unit{\frac{m^2 \cdot kg}{s^2}}$ või lühemalt $\unit{m \cdot N}$ või veelgi lühemalt $\unit{J}$.

Siseenergia muut:

```{=tex}
\begin{align}
\Delta(U) = q + E
(\#eq:internal-energy)
\end{align}
```

[@Mills1993-oj, p. 56]

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{L^2 \cdot M}{T^2}},
(\#eq:dimensional-analysis-for-internal-energy)
\end{align}
```

mille põhjal on ühik $\unit{\frac{m^2 \cdot kg}{s^2}}$ või lühemalt $\unit{m \cdot N}$ või veelgi lühemalt $\unit{J}$.

Entalpia:

```{=tex}
\begin{align}
H := U + p \cdot V
(\#eq:enthalpy)
\end{align}
```

[@Mills1993-oj, p. 56]. Dimensionaalanalüüs:


```{=tex}
\begin{align}
\mathrm{\frac{L^2 \cdot M}{T^2} + \frac{M}{L \cdot T^2} \cdot L^3 = \frac{L^2 \cdot M}{T^2}},
(\#eq:dimensional-analysis-for-enthalpy)
\end{align}
```

mille põhjal ühik on $\unit{\frac{m^2 \cdot kg}{s^2}}$ või lühemalt $\unit{m \cdot N}$ või veelgi lühemalt $\unit{J}$.

Aurustumissoojus:

```{=tex}
\begin{align}
\Delta_\text{vap}(H) := H_\text{g} - H_\text{l}
(\#eq:enthalpy-of-vaporization)
\end{align}
```

[@Mills1993-oj, p. 59].

Erientalpia:

```{=tex}
\begin{align}
h := \frac{H}{m}
(\#eq:specific-enthalpy)
\end{align}
```

[@Mills1993-oj, p. 16]. Dimensionaalanalüüs:


```{=tex}
\begin{align}
\mathrm{\frac{L^2 \cdot M}{T^2 \cdot M} = \frac{L^2}{T^2}},
(\#eq:dimensional-analysis-for-specific-enthalpy)
\end{align}
```

mille põhjal ühik on $\unit{\frac{m^2}{s^2}}$ või lühemalt $\unit{\joule\per\kilogram}$.

Soojusmahtuvus konstantsel rõhul:

```{=tex}
\begin{align}
C_p := (\frac{\partial{H}}{\partial{T}})_p
(\#eq:heat-capacity)
\end{align}
```

[@Mills1993-oj, p. 56, @haynes_2014_crc, p. 2-69]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\frac{\mathrm{\frac{L^2 \cdot M}{T^2}}}{\Theta} = \frac{\mathrm{L^2 \cdot M}}{\mathrm{T^2} \cdot \Theta},
(\#eq:dimensional-analysis-for-heat-capacity)
\end{align}
```

mille põhjal ühik on $\unit{\meter\squared\kilogram\per\second\squared\per\kelvin}$ või lühemalt $\unit{\meter\newton\per\kelvin}$ või veelgi lühemalt $\unit{\joule\per\kelvin}$.

Erisoojus konstantsel rõhul:

```{=tex}
\begin{align}
c_p := \frac{C_p}{m}
(\#eq:specific-heat-capacity)
\end{align}
```

[@Mills1993-oj, p. 16, @haynes_2014_crc, pp. 2-55, 2-65]. Dimensionaalanalüüs:


```{=tex}
\begin{align}
\frac{\frac{\mathrm{L^2 \cdot M}}{\mathrm{T^2} \cdot \Theta}}{\mathrm{M}} = \frac{\mathrm{L^2}}{\mathrm{T^2} \cdot \Theta},
(\#eq:dimensional-analysis-for-specific-heat-capacity)
\end{align}
```

mille põhjal ühik on $\unit{\meter\squared\per\second\squared\per\kelvin}$ või lühemalt $\unit{\joule\per\kelvin\per\kilogram}$.

## Mool

Avaldan ideaalse gaasi rõhu valemist \@ref(eq:pressure-of-ideal-gas) ainehulga:

```{=tex}
\begin{align}
n := \frac{p \cdot V}{R \cdot T}
(\#eq:amount-of-ideal-gas)
\end{align}
```

[@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 14]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\frac{\mathrm{\frac{M}{L \cdot T^2} \cdot L^3}}{\frac{\mathrm{M \cdot L^2}}{\mathrm{T^2 \cdot N} \cdot \Theta} \cdot \Theta} = \mathrm{\frac{\cancel{M} \cdot \cancel{L^2} \cdot \cancel{T^2} \cdot N}{\cancel{T^2} \cdot \cancel{M} \cdot \cancel{L^2}} = N},
(\#eq:dimensional-analysis-for-amount-of-ideal-gas)
\end{align}
```

mis tähendab, et ühik on $\unit{\mole}$.

Moolfraktsioon võib olla ka rõhufraktsioon:

```{=tex}
\begin{align}
x := \frac{n_\text{B}}{n}.
(\#eq:mole-fraction)
\end{align}
```

Dimensioonanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{N}{N}} = 1.
(\#eq:dimensional-analysis-for-mole-fraction)
\end{align}
```


## Mass

### Molaarmass

molaarmass
: aine ühe mooli mass [@haynes_2014_crc, p. 2-60]

```{=tex}
\begin{align}
M_\mathrm{B} := \frac{m}{n_\mathrm{B}},
(\#eq:molar-mass)
\end{align}
```

kus $n_\mathrm{B}$ on (aine)hulk [@haynes_2014_crc, p. 2-8]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{M}{N}},
(\#eq:dimensional-analysis-for-molar-mass)
\end{align}
```

mistõttu ühik on $\unit{\kilogram\per\mole}$.


Lähtemolaarmasside arvutamiseks kasutan [@Mills1993-oj, pp. 101-103, 105] andmeid:

```{r label = "molar-masses"}
M_H_1_TO_M_H <- 99.9851e-2
M_H <- (1.00782503512 * M_H_1_TO_M_H + 2.01410177924 * (1 - M_H_1_TO_M_H)) * 1e-3
M_He_1_TO_M_He <- 0.0001373e-2
M_He <- (3.016029314 * M_He_1_TO_M_He + 4.00260325 * (1 - M_He_1_TO_M_He)) * 1e-3
M_C_1_TO_M_C <- 98.903e-2
M_C <- (12 *  M_C_1_TO_M_C + 13.00335482617 * (1 - M_C_1_TO_M_C)) * 1e-3
M_N_1_TO_M_N <- 99.635e-2
M_N <- (14.00307400226 * M_N_1_TO_M_N + 15.000108974 * (1 - 99.635e-2)) * 1e-3
M_O_TO_M_O <- c(99.76215e-2, 0.0383e-2)
M_O <- (15.994914636 * M_O_TO_M_O[1]  + 16.99913124 * M_O_TO_M_O[2] + 17.9991604 * (1 - sum(M_O_TO_M_O))) * 1e-3
M_Ne_TO_M_Ne <- c(90.483e-2, 0.271e-2)
M_Ne <- (19.992435622 * M_Ne_TO_M_Ne[1] + 20.993842821 * M_Ne_TO_M_Ne[2]  + 21.991383118 * (1 - sum(M_Ne_TO_M_Ne))) * 1e-3
M_Ar_TO_M_Ar <- c(0.3373e-2, 0.0631e-2)
M_Ar <- (35.9675455229 * M_Ar_TO_M_Ar[1] + 37.9627326 * M_Ar_TO_M_Ar[2] + 39.962383714 * (1 - sum(M_Ar_TO_M_Ar))) * 1e-3
M_Kr_TO_M_Kr <- c(0.352e-2, 2.252e-2, 11.61e-2, 11.51e-2, 57.03e-2)

M_Kr <- (77.920397 * M_Kr_TO_M_Kr[1] + 79.916381 * M_Kr_TO_M_Kr[2] + 81.913483 * M_Kr_TO_M_Kr[3] + 82.9141354 * M_Kr_TO_M_Kr[4] + 83.9115074 * M_Kr_TO_M_Kr[5] + 85.910617 * (1 - sum(M_Kr_TO_M_Kr))) * 1e-3

M_Xe_TO_M_Xe <- c(0.101e-2, 0.091e-2, 1.913e-2, 26.5e-2, 4.11e-2, 21.24e-2, 27e-2, 10.42e-2)

M_Xe <- (123.90589422 * M_Xe_TO_M_Xe[1] + 125.904282 * M_Xe_TO_M_Xe[2] + 127.9035312172 * M_Xe_TO_M_Xe[3] + 128.904780121 * M_Xe_TO_M_Xe[4] + 129.9035094172 * M_Xe_TO_M_Xe[5] + 130.905073 * M_Xe_TO_M_Xe[6] + 131.904145 * M_Xe_TO_M_Xe[7] + 133.905396 * M_Xe_TO_M_Xe[8] + 135.907215 * (1 - sum(M_Xe_TO_M_Xe))) * 1e-3

M_H2O <- M_H * 2 + M_O
M_H2O_haynes <- 18.015268e-3

```

Vee molaarmass on vastavalt [@haynes_2014_crc, p. 6-9] $`r M_H2O_haynes` \times \unit{\kilogram\per\mole}$ ning minu arvutustele $`r M_H2O` \times \unit{\kilogram\per\mole}$. Kuna enda äralöök on kindlam kui loodetav vastase aut, siis kasutan edaspidi arvutustes enda arvutusi, kui pole sätestatud teisiti.

Õhu molaarmassi saaks ka otse teatmikust võtta, aga tahan ikkagi näidata, millest see on kokku arvutatud. Õhk koosneb mitmest komponendist, millest kõik peale süsihappegaasi ja hapniku on piisavalt püsiva osalusega. Süsihappegaasi sisaldus õhus varieerub pidevalt. Mida rohkem on õhus süsihappegaasi, seda vähem on kuivas õhus hapnikku ja vastupidi, sest põlemises liidab süsinik endaga dihapniku õhust. Õhu molaarmass muutub seega sõltuvalt sellest, kui palju süsinikku kas õhku lisandub või sellest eraldub. Praegu elame perioodis, milles süsinikku kuiva õhku lisandub. Õhu koostist, muuhulgas süsinikdioksiidi sisaldust mõõdetakse iga tund. Leidsin Barrow Atmospheric Baseline Observatory' andmed, mis on kogutud $\qty{27}{\meter}$ kõrguselt, mis on umbes see kõrgus, kus me oma eksperimente tegime ja mis on kõige kaasaegsemad [@NOAA_GML_CCGG_Group2019-oq]. Kuigi [@RN23688432420080101, p. 1] mainitakse, et praktiline oleks kasutada selliste andmete põhjal tehtud projektsioonväärtust, samas kurdetakse, et aktuaalset väärtust on keeruline leida [@RN23688432420080101, p. 3], soovin mina kasutada viimati väljamõõdetud väärtust, sest sellest pole liiga palju aega möödunud. Viimatised andmed on nimelt pärit 2021. aasta viimasest päevast, millest praeguse aruande kirjutamiseni on möödas veidi üle poole aasta. Süsinikdioksiidi osa kuivas õhus aastais 1973 kuni 2021 on esitatud joonisel \@ref(fig:co2-in-air).

(ref:x-citation) @Mills1993-oj, p. 84

```{r label = "co2-in-air", fig.cap="Süsinikdioksiidi osa kuivas õhus aastais 1973 kuni 2021 ((ref:x-citation))."}
CO2_in_air <- read.table("co2_brw_surface-insitu_1_ccgg_DailyData.txt", header = TRUE, sep = "", dec = ".")

librarian::shelf(
  ggplot2,
  latex2exp
)

CO2_in_air <- subset(CO2_in_air, value > -999.99)

ggplot(data = CO2_in_air, aes(x = time_decimal, y = value)) + geom_point() +
  labs(x = TeX("$\\frac{t}{s}$"), y = TeX("$\\frac{x \\times 10^{-6}}{\\frac{mol({CO_2})}{mol(air)}}$"))
```


Õhu molaarmassi võib võtta teatmikust, aga võib ka õhu koostisosade molaarmasside põhjal ise arvutada, et näha, millest õhu molaarmass koosneb. [@haynes_2014_crc, p. 6-164] põhjal esinevad lämmastik, hapnik ja vesinik kaksikaatomist koosneva lihtainena.

(ref:m-trace-citation) @RN23688432420080101, p. 4

```{r label = "consistence-of-air"}
SUBSTANCE <- c(
  "$\\ce{N_2}$",
  "$\\ce{O_2}$",
  "$\\ce{Ar}$",
  "$\\ce{CO_2}$",
  "$\\ce{Ne}$",
  
  "$\\ce{He}$",
  "$\\ce{Kr}$",
  "$\\ce{Xe}$",
  "$\\ce{CH_4}$",
  "$\\ce{H_2}$",
  
  "$\\ce{N_2O}$",
  "$\\ce{CO}$"
)

M_O2 <- M_O * 2
M_N2 <- M_N * 2

M <- c(
  M_N2,
  M_O2,
  M_Ar,
  M_C + M_O2,
  M_Ne,
  
  M_He,
  M_Kr,
  M_Xe,
  M_C + M_H * 4,
  M_H * 2,
  
  M_N2 + M_O,
  M_C + M_O
)

x_CO2 <- 420.99
DELTA_CO2 <- x_CO2 - 385
PART <- c(
  780818,
  209435 - DELTA_CO2,
  9332,
  x_CO2,
  18.2,

  5.2,
  1.1,
  .1,
  1.5,
  .5,

  .3,
  .2
)

M_psi <- M * PART

composition_of_air <- data.frame(SUBSTANCE, M, PART, M_psi)
NUMBER_OF_COMPONENTS <- nrow(composition_of_air)
START_INDEX_FOR_TRACE_GASES <- 5
mean_trace <- sum(M[START_INDEX_FOR_TRACE_GASES:NUMBER_OF_COMPONENTS] * PART[START_INDEX_FOR_TRACE_GASES:NUMBER_OF_COMPONENTS] / sum(PART[START_INDEX_FOR_TRACE_GASES:NUMBER_OF_COMPONENTS]))
psi_trace <- 1e6 - sum(PART)

colnames(composition_of_air) <- c(
  "Koostisosa",
  "Molaarmass $\\frac{M}{\\unit{\\kilogram\\per\\mol}}$",
  "Moolifraktsioon $\\frac{\\psi}{\\unit{\\micro\\mole(\\text{i})\\per\\mole(\\text{air})}}$",
  "Osalus molaarmassis $\\frac{M \\cdot \\psi}{\\unit{\\milli\\gram\\per\\mole}}$"
)

librarian::shelf(
  "dplyr",
  "janitor",
  "kableExtra"
)

composition_of_air <- arrange(composition_of_air, desc(`Osalus molaarmassis $\\frac{M \\cdot \\psi}{\\unit{\\milli\\gram\\per\\mole}}$`))

composition_of_air[NUMBER_OF_COMPONENTS + 1, ] <- c(
  "ülejäänud jälgained",
  mean_trace,
  psi_trace,
  mean_trace * psi_trace
)

composition_of_air[, 2:4] <- as.numeric(unlist(composition_of_air[, 2:4]))

composition_of_air_with_totals <- adorn_totals(dat = composition_of_air, name = "Kokku", where = "row", fill = "", na.rm = TRUE, c(3, 4))
M_air_2008 <- 28.965369e-3
M_air <- composition_of_air_with_totals[nrow(composition_of_air_with_totals), 4] * 1e-6
delta_M_air <- (M_air - M_air_2008)

print_table(
  data_frame = composition_of_air_with_totals,
  caption = "Kuiva õhu koostis.",
  digits = 3
) %>%
  column_spec(4, width = "6em") %>%
  footnote(number = c(
    paste("Süsinikdioksiidi molaarmass on 2021. aasta lõpu seisuga $\\\\qty{", DELTA_CO2, "}{\\\\kilogram\\\\per\\\\mole}$ võrra suurem kui 2008. aastas, mistõttu on õhu molaarmass $\\\\qty{", signif(delta_M_air, digits = 2), "}{\\\\kilogram\\\\per\\\\mole}$ võrra suurem."),
    "Ülejäänud jälgainete molaarmass on viimase kaheksa õhu komponendi ehk jälggaaside molaarmasside kaalutud keskmine, mis on sarnane (ref:m-trace-citation) kirjapandud molaarmassile."
    ), escape = F, footnote_as_chunk = T, threeparttable = TRUE)

```


Kuiva õhu molaarmass on vastavalt minu arvutustele $\qty{`r M_air`}{\kilogram\per\mole}$, oli 2008. aastas vastavalt [@RN23688432420080101, p. 4]  $\qty{`r M_air_2008`}{\kilogram\per\mole}$, on vastavalt [@haynes_2014_crc, p. 6-164]

$$\mathrm{28.9655 \times \frac{\cancel{g}}{mol} \times \frac{10^{-3} \times kg}{1 \times \cancel{g}} = 2.89655 \times 10^{-2} \times \frac{kg}{mol}},$$

vastavalt  [@haynes_2014_crc, p. 14-21]

$$\mathrm{28.964 \times \frac{\cancel{g}}{mol} \times \frac{10^{-3} \times kg}{1 \times \cancel{g}} = 2.8964 \times 10^{-2} \times \frac{kg}{mol}}$$
ja vastavalt  [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 7]

$$\mathrm{28.966 \times \frac{\cancel{g}}{mol} \times \frac{10^{-3} \times kg}{1 \times \cancel{g}} = 2.8966 \times 10^{-2} \times \frac{kg}{mol}}.$$

Gaasi erikonstant:

```{r label = "specific-r"}
R_d <- R / M_air
R_w <- R / M_H2O
```

```{=tex}
\begin{align}
r := \frac{R}{M}
(\#eq:specific-gas-constant)
\end{align}
```
[@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 7]. Dimensioonanalüüs:

```{=tex}
\begin{align}
\frac{\frac{\mathrm{\frac{L^2 \cdot \cancel{M}}{T^2}}}{\mathrm{\cancel{N}} \cdot \Theta}}{\mathrm{\frac{\cancel{M}}{\cancel{N}}}} = \frac{\mathrm{L^2}}{\mathrm{T^2} \cdot \Theta},
(\#eq:dimensional-analysis-for-specific-gas-constant)
\end{align}
```

mille põhjal on ühik $\unit{\meter\squared\per\second\squared\per\kelvin}$ või lühemalt $\unit{\joule\per\kilogram\per\kelvin}$.

Kuiva õhu gaasikonstant on $\qty{`r R_d`}{\joule\per\kilogram\per\kelvin}$ ($\qty{287.042}{\joule\per\kilogram\per\kelvin}$) ja veeauru gaasikonstant on $\qty{`r R_w`}{\joule\per\kilogram\per\kelvin}$.

Veeauru ja kuiva õhu molaarmasside suhe:
```{r label = "ratio-M"}
M_w_TO_M_d <- M_H2O / M_air

```

```{=tex}
\begin{align}
\epsilon := \frac{M(\ce{H_2O})}{M_\text{d}} = \frac{`r M_H2O` \times \unit{\kilogram\per\mole}}{`r M_air` \times \unit{\kilogram\per\mole}} = `r M_w_TO_M_d`,
(\#eq:ratio-molecular-weight-of-water-vapour-to-dry-air)
\end{align}
```

milles *d* tähendab kuiva õhku [@inbook, p. 33].

Psühhomeetriline konstant on konstant ainult püsiva rõhu korral, mis tähendab, et tegelikult ei ole konstant, vaid lihtsalt tegur:
```{r label = "psychrometric-coefficient"}
c_p_d <- 1.006e3
delta_vap_h <- 2500.9e3
EPSILON_WITHOUT_P <- c_p_d / (M_w_TO_M_d * delta_vap_h)
B <- .5 / 755

#' This function calculates the psychrometric coefficient.
#'
#' @param P the atmospheric pressure
#' @param type_of_psychrometer either "ventilated", "natural ventilated" or "non-ventilated" or if left out, the universal constant will be used from the year 1933
#' 
#' @returns the psychrometric coefficient
calculate_gamma <- function(P, type_of_psychrometer = NULL) {
  
  if (is.null(type_of_psychrometer)) {
    a_psy <- B
  } else if ("ventilated" == type_of_psychrometer) {
    a_psy <- EPSILON_WITHOUT_P
  } else if ("natural ventilated" == type_of_psychrometer) {
    a_psy <- 8e-4
  } else if ("non-ventilated" == type_of_psychrometer) {
    a_psy <- 1.2e-3
  } else {
    stop(paste("The type of the psychrometer must be either \"ventilated\", \"natural ventilated\" or \"non-ventilated\" or left out for the year 1933 value. The current type is", type_of_psychrometer, "."))
  }
  
  return(signif(a_psy * P, digits = 4))
}

```


```{=tex}
\begin{align}
\gamma := \frac{c_p \times P}{\epsilon \times \lambda} = \frac{`r c_p_d` \times \unit{\joule\per\kilogram\per\kelvin} \times P}{`r M_w_TO_M_d` \times `r delta_vap_h` \times \unit{\joule\per\kilogram}} = `r EPSILON_WITHOUT_P` \times \unit{\per\kelvin} \times P,
(\#eq:psychrometric-coefficient)
\end{align}
```

milles $c_p$ on õhu erisoojus, $\lambda$ on vee aurustumissoojus [@haynes_2014_crc, pp. 1-25, 6-5, 6-17], [@Goodfellow2001-ce, p. 1470], [@inbook, pp. 32 to 33]. Kuigi [@inbook, p. 33] kasutatakse nii õhu erisoojust kui vee aurustumissoojust mingite muude temperatuuride kui standardtemperatuuri korral, mina kasutan neid standardtemperatuuri korral, et oleks ühtne süsteem. Sellest johtuvalt on minu psühhomeetriline tegur [@inbook] omast erinev. Ühtlasi väärib mainimist, et [@a2022_cranmeto] on implementeeritud [@inbook, p. 33] teisend. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\frac{\mathrm{M}}{\mathrm{L \cdot T^2} \cdot \Theta},
(\#eq:dimensional-analysis-for-psychrometric-coefficient)
\end{align}
```

millest johtuvalt on ühik $\unit{\kilogram\per\meter\per\second\squared\per\kelvin}$ ehk lühemalt $\unit{\pascal\per\kelvin}$. Psühromeetriline tegur on erinev sõltuvalt sellest, kas psühhomeeter on ventileeritud ja kuidas see on ventileeritud. Valem \@ref(eq:psychrometric-coefficient) kehtib automaatselt ventileeritud psühhomeetri kasutamise puhul, milles õhk liigub umbes $\qty{5}{\meter\per\second}$ nagu nt \textcolor{teal}{Assmanni psühhomeetris}. Loomuliku ventilatsiooniga psühhomeetri puhul, milles õhk liigub umbes  $\qty{1}{\meter\per\second}$, soovitatakse [@inbook, p. 38] kasutada valemit

```{=tex}
\begin{align}
\gamma := 8 \times 10^{-4} \times \unit{\per\kelvin} \times P.
(\#eq:psychrometric-coefficient-for-natural-ventilation)
\end{align}
```

Kui psühromeetril ventilatsioon üldse puudub, tuleb kasutada valemit:

```{=tex}
\begin{align}
\gamma := 1.2 \times 10^{-3} \times \unit{\per\kelvin} \times P.
(\#eq:psychrometric-coefficient-without-ventilation)
\end{align}
```

[@Whipple_1933] üldistatakse psühhomeetrilise teguri valem selliseks ja sellist valemit tohib kasutada vedela vee kohta:

```{=tex}
\begin{align}
\gamma := \frac{.5}{755} \times P = `r B` \times \unit{\per\kelvin} \times P.
(\#eq:psychrometric-coefficient-in-whipple)
\end{align}
```

Kui kastepunkt ei ole teada, mis psühhomeetri kasutamise puhul nii ongi, saab kasutada järgmist valemit, millesse on kaasatud psühhomeetriline tegur:
```{r label = "calculate_p_a"}
#' This function calculates the actual vapor pressure.
#'
#' @param p_sat_at_T_w the saturation pressure at the temperature of the wet bulb
#' @param gamma the psychrometric constant
#' @param T_d the absolute temperature of the dry bulb
#' @param T_w the absolute temperature of the wet bulb
#' 
#' @returns the actual vapor pressure
calculate_p_a <- function(p_sat_at_T_w, gamma, T_d, T_w) {
  return(signif(p_sat_at_T_w - gamma * (T_d - T_w), digits = 4))
}

```

```{=tex}
\begin{align}
p_\text{a} := p_\text{sat}(T_\text{w}) - \gamma \cdot (T_\text{d} - T_\text{w}).
(\#eq:actual-vapor-pressure)
\end{align}
```

Avaldan tegeliku veeauru rõhu valemist \@ref(eq:actual-vapor-pressure) märja kolviga termomeetri näidu:
```{r label = "calculation-of-wet-bulb-temperature"}
calculate_T_w <- function(p_a, gamma, T_d, p_sat_at_T_w) {
  return((p_a + gamma * T_d - p_sat_at_T_w) / gamma)
}

```

```{=tex}
\begin{align}
p_\text{a} :&= p_\text{sat}(T_\text{w}) - \gamma \cdot T_\text{d} + \gamma \cdot T_\text{w}\\
\gamma \cdot T_\text{w} &= p_\text{a} + \gamma \cdot T_\text{d} - p_\text{sat}(T_\text{w})\\
T_\text{w} :&= \frac{ p_\text{a} + \gamma \cdot T_\text{d} - p_\text{sat}(T_\text{w})}{\gamma}.
(\#eq:wet-bulb-temperature)
\end{align}
```

### Massi voolukiirus


```{=tex}
\begin{align}
q_m := \frac{\text{d}(m)}{\text{d}(t)}
(\#eq:mass-flow-rate)
\end{align}
```

[@haynes_2014_crc, p. 2-11]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{M}{T}},
(\#eq:dimensional-analysis-for-mass-flow-rate)
\end{align}
```

millest johtuvalt on ühik $\unit{\kilogram\per\second}$.

### Massikontsentratsioon (massi tihedus)


```{=tex}
\begin{align}
γ_\mathrm{B} := \frac{m_\mathrm{B}}{V}
(\#eq:mass-concentration)
\end{align}
```

[@haynes_2014_crc, p. 2-8].

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{M}{L^3}},
(\#eq:dimensional-analysis-for-mass-concentration)
\end{align}
```

millest johtuvalt on ühik $\unit{\kilogram\per\cubic\metre}$.

Ideaalse gaasi tiheduse valemi loomiseks asendan ideaalse gaasi rõhu valemisse \@ref(eq:pressure-of-ideal-gas) leheküljel $\pageref{eq:pressure-of-ideal-gas}$ molaarmassi valemist \@ref(eq:molar-mass) leheküjel $\pageref{eq:molar-mass}$ ainehulga:


```{=tex}
\begin{align}
p :&= \frac{\frac{m}{M_\mathrm{B}} \cdot R \cdot T}{V}\\
p :&= \frac{m \cdot R \cdot T}{M_\mathrm{B} \cdot V}\\
\frac{m}{V} &= \frac{p \cdot M_\mathrm{B}}{R \cdot T} =: \gamma_\mathrm{B}.
(\#eq:mass-concentration-of-ideal-gas)
\end{align}
```

Dimensionaalanalüüs:


```{=tex}
\begin{align}
\mathrm{\frac{M}{L^3}} = \frac{\mathrm{\frac{M}{T^2 \cdot L} \cdot \frac{M}{N}}}{\frac{\mathrm{\frac{L^2 \cdot M}{T^2}}}{\mathrm{N} \cdot \Theta} \cdot \Theta} = \frac{\mathrm{M^2 \cdot N} \cdot \Theta}{\mathrm{T^2 \cdot L \cdot N \cdot \frac{L^2 \cdot M}{T^2}} \cdot \Theta},
(\#eq:dimensional-analysis-for-mass-concentration-of-ideal-gas)
\end{align}
```

mistõttu ühik on $\unit{\kilogram\per\cubic\meter}$.

Küllastava veeauru tiheduse arvutamiseks pistan rõhu küllastusrõhu valemist \@ref(eq:saturation-pressure-over-liquid-h2o) ideaalse gaasi tiheduse valemisse:

```{=tex}
\begin{align}
\gamma_\mathrm{B} &= \frac{e^{\sum_{i := 8}^n{C_i \times (t + 273.15)^{i - 9}} + 6.5459673 \times \mathrm{ln}(t + 273.15)} \cdot M_\mathrm{B}}{R \cdot T}.
(\#eq:density-of-saturated-h2o)
\end{align}
```
```{r label = "mass-concentration-t"}

librarian::shelf("psychrolib")

T_min <- GetTKelvinFromTCelsius(0)
T_max <- GetTKelvinFromTCelsius(200)
```

Lasen koostada tabeli \@ref(tab:density-of-saturated-h2o) küllastava veeauru tiheduse kohta vastavalt temperatuurile vahemikus $`r T_min` \times \unit{\kelvin}$ kuni $`r T_max` \times \unit{\kelvin}$:
```{r label = "density-of-saturated-h2o"}
t <- c(seq(0, 14, 2), seq(15, 27.9, .1), seq(28, 200, 4))
T <- GetTKelvinFromTCelsius(t)

p_H2O <- calculate_p_sat(T, method = "ASHRAE")

calculate_gamma_H2O <- function(p_H2O, T) {
  return(p_H2O * M_H2O / (R * T))
}

gamma_H2O <- calculate_gamma_H2O(p_H2O, T)

density_of_saturated_H2O <- data.frame(
  t,
  T,
  p_H2O,
  gamma_H2O
)

colnames(density_of_saturated_H2O) <- c(
  "$\\frac{\\text{Temperatuur}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{\\text{Absoluutne temperatuur}}{\\unit{\\kelvin}}$",
  "$\\frac{\\text{Rõhk}}{\\unit{\\pascal}}$",
  "$\\frac{\\text{Küllastava veeauru tihedus}}{\\unit{\\kilogram\\per\\cubic\\meter}}$"
)

print_table(density_of_saturated_H2O, caption = paste("Küllastava veeauru tihedused vahemikus", T_min, "$\\times \\unit{\\kelvin}$ kuni",  T_max, "$\\times \\unit{\\kelvin}$."), digits = 5) %>%
  row_spec(which(t == 24.0), color = "red") %>%
  row_spec(which(t == 23.6), color = "teal") %>%
  row_spec(which(t == 16.5), color = "red") %>%
  row_spec(which(t == 15.2), color = "teal")


```

Näeme jooniselt \@ref(fig:diagram-for-density-of-saturated-h2o), kuidas temperatuuri suurenedes eksponentsiaalselt suureneb küllastava veeauru tihedus. See tähendab, et mida soojem on õhk, seda rohkem veeauru õhku mahub. Inimesele sobivates tingimustes õhutemperatuuri puhul on küllastava veeauru tiheduse erinevus eri temperatuuridel peaaegu mittemärgatav ja nullilähedane.

```{r label = "diagram-for-density-of-saturated-h2o", fig.cap="Küllastava veeauru tiheduse sõltuvus temperatuurist."}
librarian::shelf(
  ggplot2,
  latex2exp
)

ggplot(data = density_of_saturated_H2O, aes(x = T, y = gamma_H2O)) +
  geom_point() +
  labs(x = TeX("$\\frac{T}{K}$"), y = TeX("$\\frac{\\gamma(H_2O)}{\\frac{kg}{m^3}}$"))

```

Näeme jooniselt \@ref(fig:diagram-for-pressure-of-saturated-h2o), kuidas temperatuuri suurenedes eksponentsiaalselt suureneb küllastava veeauru rõhk.


```{r label = "diagram-for-pressure-of-saturated-h2o", fig.cap="Küllastava veeauru rõhu sõltuvus temperatuurist."}
librarian::shelf(
  ggplot2,
  latex2exp
)

ggplot(data = density_of_saturated_H2O, aes(x = T, y = p_H2O)) +
  geom_point() +
  labs(x = TeX("$\\frac{T}{K}$"), y = TeX("$\\frac{p(H_2O)}{Pa}$"))

```


## Niiskus

Joonisel \@ref(fig:adiabatic-saturation-wet-bulb-temperature) on näha soojusisoleeritud piisavalt pikk toru, milles toodetakse niisket õhku. Juurdevoolav vesi on justkui märgkolvi ümber olev vesi psühromeetris.


(ref:adiabatic-saturation-wet-bulb-temperature) @adiabatic

```{r label = "adiabatic-saturation-wet-bulb-temperature", fig.cap = "Vasakult siseneb kuiv õhk, mida niisutab alt voolav vesi. Tulemuseks on paremalt väljuv täielikult niiske õhk ((ref:adiabatic-saturation-wet-bulb-temperature)).", fig.margin = TRUE}
include_svg("adiabatic-saturation-temperature-wet-bulb-temperature.png")
```

niiskus
: õhus oleva vee massi suhe kuiva õhu massi [@a2018_determination]

kuivkolvi temperatuur
:  puhkeolekus mõõdetud niiskuse temperatuur, mida õhu niiskusesisaldus ega kiirgus ei mõjuta[@a2018_determination]

märgkolbi temperatuur
: dünaamiline tasakaalutemperatuur, mille veepind saavutab adiabaatilistes tingimustes õhuga kokkupuutel[@a2018_determination]

niiskuse suhe
: proovis oleva veeauru massi ja kuiva õhu massi suhe [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 14]

```{r label = "W"}
#' Return humidity ratio of saturated air given dry-bulb temperature.
#'
#' @param T_d A numeric vector of dry-bulb temperature in [SI]
#' @param method the method of calculation: "ASHRAE" or "FAO"
#'
#' @return A numeric vector of humidity ratio of saturated air in kg_H2O kg_Air-1 [SI]
#'
#' @references
#' ASHRAE Handbook - Fundamentals (2017) ch. 1 eqn 36, solved for W
#'
#' @examples
#' calculate_W(298.15)
#'
#' @export
calculate_W_saturated <- function(T_d, method) {
  
  if (is.null(method)) {
    stop("The method must be either \"ASHRAE\" or \"FAO\". The method is currently not set.")
  } else if ("ASHRAE" == method | "FAO" == method) {
    p_sat <- calculate_p_sat(T_d, method = method)
  } else {
    stop(paste("The method must be either \"ASHRAE\" or \"FAO\". The method is currently", method, "."))
  }

  W_saturated <- M_w_TO_M_d * p_sat / (p_at - p_sat)

  return(signif(W_saturated, digits = 5))
}

```

Absoluutne niiskuse suhe näitab, kui palju veeauru õhk teatud temperatuuril suudab mahutada. Kasutan absoluutse niiskuse suhte valemis molaarmassi valemit \@ref(eq:molar-mass) leheküljel $\pageref{eq:molar-mass}$ ja edasi ideaalse rõhu gaasi valemit \@ref(eq:pressure-of-ideal-gas) leheküljel $\pageref{eq:pressure-of-ideal-gas}$:

```{=tex}
\begin{align}
W := \cfrac{m_\text{w}}{m_\text{d}} = \cfrac{M_\text{w} \cdot n_\text{w}}{M_\text{d} \cdot n_\text{d}} = \cfrac{M_\text{w} \cdot p_\text{w} \cdot \cancel{V} \cdot \cancel{R} \cdot \cancel{T}}{\cancel{R} \cdot \cancel{T} \cdot M_\text{d} \cdot p_\text{d} \cdot \cancel{V}} = \frac{M_\text{w} \cdot p_\text{w}}{M_\text{d} \cdot p_\text{d}} = \frac{`r M_w_TO_M_d` \times p_\text{w}}{p - p_\text{w}},
(\#eq:humidity-ratio)
\end{align}
``` 

milles *w* tähendab veeauru ja *d* kuiva õhku [@absolute].

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{\frac{M}{T^2 \cdot L}}{\frac{M}{T^2 \cdot L}}} = 1.
(\#eq:dimensional-analysis-for-humidity-ratio)
\end{align}
``` 

Küllastusaste:

```{=tex}
\begin{align}
\mu := \frac{W}{W_\text{sat}}|_{T, P}
(\#eq:degree-of-saturation)
\end{align}
``` 

[@numerically-degree-of-saturation]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\frac{1}{1} = 1.
(\#eq:dimensional-analysis-for-degree-of-saturation)
\end{align}
``` 

Avaldan kogurõhu niiskuse suhte valemist \@ref(eq:humidity-ratio) leheküljel $\pageref{eq:humidity-ratio}$:

```{=tex}
\begin{align}
W \times p - W \times p_\text{w} &= `r M_w_TO_M_d` \times p_\text{w}\\
W \times p &= `r M_w_TO_M_d` \times p_\text{w} + W \times p_\text{w}\\
W \times p &= (`r M_w_TO_M_d` + W) \times p_\text{w}\\
p :&= \frac{(`r M_w_TO_M_d` + W) \times p_\text{w}}{W} = \frac{(`r M_w_TO_M_d` + W_\text{sat}) \times p_\text{sat}(\text{w})}{W_\text{sat}}
(\#eq:total-pressure)
\end{align}
``` 

[@numerically-degree-of-saturation].


Avaldan veeauru osarõhu niiskuse suhte valemist:

```{=tex}
\begin{align}
W \times p - W \times p_\text{w} &= `r M_w_TO_M_d` \times p_\text{w}\\
W \times p_\text{w} + `r M_w_TO_M_d` \times p_\text{w} &= W \times p\\
p_\text{w} :&= \frac{W \times p}{W + `r M_w_TO_M_d`}.
(\#eq:partial-vapor-pressure-from-humidity-ratio)
\end{align}
``` 


suhteline niiskus
: õhus oleva veeauru osarõhu ja vee küllastusauru rõhu suhe samal 
temperatuuril, väljendatud protsentides [@haynes_2014_crc, p. 2-63]

Suhteline niiskus näitab, kui palju veeauru õhk maksimaalsest võimalikust teatud temperatuuril mahutab. Suhtelise niiskuse valem, millesse asendan massi molaarmassi valemist \@ref(eq:molar-mass) leheküljel $\pageref{eq:molar-mass}$, ainehulga ideaalse gaasi valemist \@ref(eq:pressure-of-ideal-gas) leheküljel $\pageref{eq:pressure-of-ideal-gas}$ ja veeauru osarõhu selle valemist niiskuse suhte kaudu \@ref(eq:partial-vapor-pressure-from-humidity-ratio) leheküljel $\pageref{eq:partial-vapor-pressure-from-humidity-ratio}$:

```{=tex}
\begin{align}
RH :&= \cfrac{m_\text{w}}{m_\text{sat}(\text{w})} = \cfrac{M_\text{w} \cdot n_\text{w}}{M_\text{sat}(\text{w}) \cdot n_\text{sat}(\text{w})} = \cfrac{M_\text{w} \cdot \frac{p_\text{w} \cdot \cancel{V}}{\cancel{R \cdot T}}}{M_\text{sat}(\text{w}) \cdot \cfrac{p_\text{sat}(\text{w}) \cdot \cancel{V}}{\cancel{R \cdot T}}} = \frac{p_\text{w}}{p_\text{sat}(\text{w})}\label{eq:relative-humidity-as-ratio-of-pressure}\\
&= \frac{\frac{W \times p}{W + `r M_w_TO_M_d`}}{p_\text{sat}(\text⅞)} = \frac{W \times p}{(W + `r M_w_TO_M_d`) \cdot p_\text{sat}(\text{w})} = \frac{x_\text{w}}{x_\text{sat}(\text{w})}|_{T, P}
(\#eq:relative-humidity)
\end{align}
```

[@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 14], [@relative], [@numerically-degree-of-saturation], [@inbook, p. 36].

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{\frac{M}{L^2 \cdot T^2}}{\frac{M}{L^2 \cdot T^2}}} = 1.
(\#eq:dimensional-analysis-for-relative-humidity)
\end{align}
```


Tabelis \@ref(tab:rh) on esitatud väljaarvutatud suhteline niiskus valitud temperatuuride korral, mida saab võrrelda [@haynes_2014_crc, p. 15-32] tabeliga.

```{r label = "rh"}
calculate_RH <- function(p_dp, p_d_H2O) {
  return(p_dp / p_d_H2O)
}

t_d <- c(seq(10, 23, 1), seq(23.1, 27, .1), seq(28, 31, 1), seq(32, 48, 2), 49, seq(50, 200, 50))
T_d <- GetTKelvinFromTCelsius(t_d)
delta_T <- c(seq(1, 7, 1), 7.5, 8, 8.4, seq(8.5, 10.5, .5), 11, 12, 15)
gamma_whipple <- calculate_gamma(p_at)

calculate_RH_from_delta_T <- function(T_d, delta_T) {
  RH <- c()
  
  for (index in 1:length(T_d)) {
    T_w <- T_d[index] - delta_T
    
    if (T_w < 273.15) {
      RH <- c(RH, "")
    } else {
      p_w_H2O <- calculate_p_sat(T_w, method = "ASHRAE")
      p_dp <- calculate_p_a(p_w_H2O, gamma_whipple, T_d[index], T_w)
      p_d_H2O <- calculate_p_sat(T_d[index], method = "ASHRAE")

      if (p_dp < 0) {
        RH <- c(RH, "")
      } else {
        RH <- c(RH, calculate_RH(p_dp, p_d_H2O))
      }
      
    }
    
  }

  return(RH)
}

RH_T <- data.frame(T_d)
librarian::shelf("dplyr")

for (index in delta_T) {
  RH <- calculate_RH_from_delta_T(T_d = T_d, delta_T = index)
  RH_numeric <- as.numeric(RH)
  RH_T <- cbind(RH_T, ifelse(is.na(RH_numeric), "", round(RH_numeric * 100, digits = 1)))
  
  if (7.5 == delta_T[index]) {
    delta_T[index] = paste("${\\color{red}", delta_T[index], "}$", sep = "")
  } else if (8.4 == delta_T[index]) {
    delta_T[index] = paste("${\\color{teal}", delta_T[index], "}$", sep = "")
  }
  
}

colnames(RH_T) <- c(
  "$\\frac{T}{\\unit{\\kelvin}}$",
  delta_T
)

RH_T <- mutate(RH_T, "${\\color{red}7.5}$" = cell_spec(`${\\color{red}7.5}$`, color = ifelse(T_d == 297.15, "red", "black")))
RH_T <- mutate(RH_T, "${\\color{teal}8.4}$" = cell_spec(`${\\color{teal}8.4}$`, color = ifelse(T_d == 296.75, "teal", "black")))
RH_T <- mutate(RH_T, "$\\frac{T}{\\unit{\\kelvin}}$" = cell_spec(T_d, color = ifelse(T_d == 296.75, "teal", ifelse(T_d == 297.15, "red", "black"))))

header_text <- c("Kuiva termomeetri näit", paste("Kuiva ja märja termomeetri näitude vahe $\\\\frac{\\\\Delta(T)}{\\\\unit{\\\\kelvin}}$"))
header_span <- c(1, length(delta_T))
header <- data.frame(header_text, header_span)

print_table(
  RH_T,
  caption = "Psühhomeetri tabel: sisuosas on esitatud suhteline õhuniiskus protsentides.",
  digits = 5,
  additional_header = header
) %>%
  column_spec(1, width = "6em") %>%
  landscape()

```

Avaldan suhtelise niiskuse valemist \@ref(eq:relative-humidity) leheküljel $\pageref{eq:relative-humidity}$ veeauru osarõhu ja asendan selle niiskuse suhte valemisse \@ref(eq:humidity-ratio) leheküljel $\pageref{eq:humidity-ratio}$:

```{=tex}
\begin{align}
W := \frac{`r M_w_TO_M_d` \times RH \times p_\text{sat}(\text{w})}{p - RH \times p_\text{sat}(\text{w})}.
(\#eq:humidity-ratio-from-relative-humidity)
\end{align}
``` 

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{\frac{M}{T^2 \cdot L}}{\frac{M}{T^2 \cdot L}}} = 1.
(\#eq:dimensional-analysis-for-humidity-ratio-from-relative-humidity)
\end{align}
``` 

Absoluutse niiskuse ehk tegelikult tiheduse arvutamiseks on juhendis valem

```{=tex}
\begin{align}
a := \gamma_\text{w} \cdot 10^3 - 0.64 \cdot (t_\text{d} - t_\text{w}).
(\#eq:a)
\end{align}
```

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\frac{M}{L^3} - \Theta,
(\#eq:dimensional-analysis-for-a)
\end{align}
```

millest lähtuvalt on ühik $\unit{\gram\per\cubic\meter} - \unit{\kelvin}$.

Valemit \@ref(eq:a) kasutatakse juhendis suhtelise niiskuse arvutamiseks:

```{=tex}
\begin{align}
RH := \frac{a}{\gamma_\text{d} \cdot 10^3}.
(\#eq:rh-in-instructions)
\end{align}
```

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\frac{\frac{M}{L^3} - \Theta}{\frac{M}{L^3}} = 1 - \frac{\Theta}{\frac{M}{L^3}} = \frac{\Theta}{\frac{M}{L^3}},
(\#eq:dimensional-analysis-for-rh-in-instructions)
\end{align}
```

millest lähtuvalt on ühik $\unit{\kelvin\per\gram\per\cubic\meter}$.

Ilmselgelt on juhendis viga, sest suhtelise niiskuse ühik võib olla kas üks või erinevate ainete samade ühikute suhe. Seega modifitseerin esmalt juhendis olevat tegeliku veeauru tiheduse õhus valemit \@ref(eq:a), et see oleks õige:
```{r}
calculate_a <- function(gamma_w, T_d, T_w) {
  gamma_w * 1e3 - .64 * (T_d - T_w)
}

```

```{=tex}
\begin{align}
a := \gamma_\text{w} \cdot 10^3 - \qty{0.64}{\kilogram\per\cubic\meter\per\kelvin} \cdot (T_\text{d} - T_\text{w}).
(\#eq:a-corrected)
\end{align}
```

Kummagi termomeetri näidu erinevuse järgi saab Carrieri psühromeetriliselt diagrammilt \@ref(fig:psychrometric-diagram) vaadata õhuniiskuse, sest eri temperatuuril on õhu võime endasse veeauru mahutada erinev ja need väärtused on katseliselt välja arvutatud.

(ref:psychrometric-chart) @psychrometric-chart
(ref:ASHRAE) @American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, pp. 17 to 18

```{r label = "psychrometric-diagram", fig.cap = "Psühromeetriline diagramm ((ref:psychrometric-chart)), mille lugemist selgitatakse (ref:ASHRAE).", fig.margin = TRUE, out.extra = 'angle=270', out.width = '.92\\textheight'}
include_svg("0000Psych11x17US_SI_logos.pdf")
```

Summaarne entalpia, millesse asendan entalpiad erientalpiatega valemist \@ref(eq:specific-enthalpy) leheküljel $\pageref{eq:specific-enthalpy}$:


```{=tex}
\begin{align}
H :&= H_\text{d} + H_\text{w} = m_\text{d} \cdot h_\text{d} + m_\text{w} \cdot h_\text{w}.
(\#eq:sum-of-enthalpy)
\end{align}
``` 

Avaldan summaarse entalpia valemist \@ref(eq:sum-of-enthalpy) erientalpia vastava valemi \@ref(eq:specific-enthalpy) alusel, asendan veeauru ja kuiva õhu massi jagatise niiskuse suhtega vastavast valemist \@ref(eq:humidity-ratio) leheküljel $\pageref{eq:humidity-ratio}$:

```{=tex}
\begin{align}
\frac{H}{m_\text{d}} &= h_\text{d} + \frac{m_\text{w}}{m_\text{d}} \cdot h_\text{w}\\
h :&= h_\text{d} + W \cdot h_\text{w}.
(\#eq:sum-of-specific-enthalpy)
\end{align}
``` 


Vee massitasakaal, milles avaldan massi niiskuse suhte valemist \@ref(eq:humidity-ratio) leheküljel $\pageref{eq:humidity-ratio}$ arvestades, et kui massi asemel on valemis massivoog, siis aeg tühistab end:


```{=tex}
\begin{align}
q_m(\text{w, in}) + q_m(\text{l}) &= q_m(\text{w, out})\\
W_\text{in} \cdot q_m(\text{d}) + q_m(\text{l}) &= W_\text{out} \cdot q_m(\text{d})\\
q_m(\text{l}) :&= q_m(\text{d}) \cdot (W_\text{out} - W_\text{in}),
(\#eq:mass-of-floating-water)
\end{align}
``` 

kus *l* tähendab *liquid* ehk *vedel*, antud juhul vedelat vett [@adiabatic].

Energiatasakaal, millesse asendan voolava vee massi voolukiiruse massitasakaalu valemist \@ref(eq:mass-of-floating-water), erientalpia summaarse erientalpiaga valemist \@ref(eq:sum-of-specific-enthalpy) leheküljel $\pageref{eq:sum-of-specific-enthalpy}$, kuiva õhu erientalpia vastavast valemist \@ref(eq:specific-enthalpy) leheküljel $\pageref{eq:specific-enthalpy}$ arvestades, et massi voolukiirust võib massi asemel kasutada, kuna aeg tühistab end, ja lõpuks kuiva õhu entalpia kuiva õhu erisoojuse ja temperatuurierinevuse korrutisega valemitest \@ref(eq:heat-capacity) leheküljel $\pageref{eq:heat-capacity}$ ja \@ref(eq:specific-heat-capacity) leheküljel $\pageref{eq:specific-heat-capacity}$:

```{=tex}
\begin{align}
q_m(\text{d}) \cdot h_\text{in} + q_m(\text{l}) \cdot h_\text{l} &= q_m(\text{d}) \cdot h_\text{out}\\
\cancel{q_m(\text{d})} \cdot h_\text{in} + \cancel{q_m(\text{d})} \cdot (W_\text{out} - W) \cdot h_\text{l} &= \cancel{q_m(\text{d})} \cdot h_\text{out}\\
h_\text{d}(\text{in}) + W \cdot h_\text{w}(\text{in}) + (W_\text{out} - W) \cdot h_\text{l} &= h_\text{d}(\text{out}) + W_\text{out} \cdot h_\text{w}(\text{out})\\
c_p \cdot (T_\text{d} - \qty{`r T_0`}{\kelvin}) + W \cdot h_\text{w}(\text{in}) + (W_\text{out} - W) \cdot h_\text{l} &= c_p \cdot (T_\text{out} - \qty{`r T_0`}{\kelvin}) + W_\text{out} \cdot h_\text{w}(\text{out}).
(\#eq:energy-balance)
\end{align}
``` 

Juhin erilist tähelepanu valemile \@ref(eq:energy-balance) ja selles temperatuuride muutudele. Ainel pole sellist omadust nagu entalpia, sest entalpia tähendab soojushulga muutu vastavalt temperatuurimuudule. Sellised muudud on välja arvutatud eksperimentaalselt ja nendest on koostatud tabelid. Kui küsitav suurus on entalpia mingi temperatuuri korral, siis see ei tähenda füüsikaliselt, et sellel ainel on mingi fikseeritud entalpia selle temperatuuri korral. See tähendab hoopis, et selle ja temperatuuri $\qty{`r T_0`}{K}$ vahele vastab entalpia muut, mis on selle temperatuuri kohta märgitud entalpia ja nullentalpia vahe, kui nullentalpiale vastab nagu minu näites $\qty{`r T_0`}{K}$. Kuna nulli lahutamine tulemust ei muuda, siis seetõttu kasutatakse valemis vahel temperatuuride muudu asemel ainult lõpptemperatuuri, mille ühik on $\unit{\degreeCelsius}$. [@reference]

Referentstemperatuur on $\qty{`r T_0`}{K}$ @American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, pp. 8 to 10 esimese peatüki teises tabelis, milles on eraldi välja toodud kuiva õhu entalpia. Referentstemperatuur on hoopis muu @haynes_2014_crc, p. 6-17 ja selle tabeli põhjal saab entalpia muudu kätte kahe temperatuuri entalpiate vahena või korrutades temperatuurimuudu algtemperatuuri soojusmahtuvuse väärtusega.

Kirjutan energia tasakaalu valemi \@ref(eq:energy-balance) leheküljel $\pageref{eq:energy-balance}$ lahti:

```{=tex}
\begin{align}
c_p \cdot (T_d - \qty{`r T_0`}{\kelvin}) + W \cdot h_\text{w}(\text{in}) + W_\text{out} \cdot h_\text{l} - W \cdot h_\text{l}\\
= c_p \cdot (T_\text{out} - \qty{`r T_0`}{\kelvin}) + W_\text{out} \cdot h_\text{w}(\text{out}).
(\#eq:energy-balance-expanded)
\end{align}
```

Avaldan laiendatud energia tasakaalu valemist \@ref(eq:energy-balance-expanded) niiskuse suhte, millesse asendan aurustumissoojuse vastavast valemist \@ref(eq:enthalpy-of-vaporization) leheküljel $\pageref{eq:enthalpy-of-vaporization}$ kasutades erientalpia valemit \@ref(eq:specific-enthalpy) leheküljel $\pageref{eq:specific-enthalpy}$:

```{=tex}
\begin{align}
W \cdot h_\text{w}(\text{in}) - W \cdot h_\text{l} &= c_p \cdot (T_\text{out} - \qty{`r T_0`}{\kelvin}) + W_\text{out} \cdot h_\text{w}(\text{out}) - c_p \cdot (T_\text{d} - \qty{`r T_0`}{\kelvin})\\
- W_\text{out} \cdot h_\text{l}\\
W :&= \frac{c_p \cdot (T_\text{out} - \qty{`r T_0`}{\kelvin}) + W_\text{out} \cdot (h_w(\text{out}) - h_\text{l}) - c_p \cdot (T_\text{d} - \qty{`r T_0`}{\kelvin})}{h_\text{w}(\text{in}) - h_\text{l}}\\
W :&= \frac{c_p \cdot (T_\text{out} - T_\text{d}) + W_\text{out} \cdot \Delta_\text{vap}(h)}{h_\text{w}(\text{in}) - h_\text{l}}.
(\#eq:humidity-ratio-from-energy-balance)
\end{align}
```

Selgitan niiskuse suhte valemi \@ref(eq:humidity-ratio-from-energy-balance) leheküljel $\pageref{eq:humidity-ratio-from-energy-balance}$ osi:

```{=tex}
\begin{align}
\underbrace{c_p \cdot (T_\text{out} - T_\text{d})}_{\text{mõistlik soojuskadu õhus}} &= \underbrace{W_\text{out} \cdot \Delta_\text{vap}(h) - W \cdot (h_\text{l} - h_\text{w}(\text{in}))}_{\text{aurustumine}}
(\#eq:humidity-ratio-from-energy-balance-explained)
\end{align}
``` 

[@difference].

Adiabaatilises protsessis küllastusentalpia:

```{=tex}
\begin{align}
h_\text{sat} :&= h + (W_\text{sat} - W) \cdot h_\text{w} = h_\text{d} + W \cdot h_\text{g} + (W_\text{sat} - W) \cdot h_\text{w}\\
&= c_p(\text{d}) \cdot (T_\text{d} - \qty{`r T_0`}{\kelvin}) + W \cdot (\Delta_\text{vap}(h) + c_p(\text{sat, w}) \cdot (T_\text{d} - \qty{`r T_0`}{\kelvin})\\
&+ (W_\text{sat} - W) \cdot c_p(\text{sat, l}) \cdot (T_\text{w} - \qty{`r T_0`}{\kelvin})\\
&= c_p(\text{d}) \cdot (T_\text{w} - \qty{`r T_0`}{\kelvin}) + W_\text{sat} \cdot (\Delta_\text{vap}(h) + c_p(\text{sat, w}) \cdot (T_\text{w} - \qty{`r T_0`}{\kelvin})
(\#eq:enthalpy-of-saturated-air)
\end{align}
``` 
[@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 15], [@numerically].
```{r label = "c_p"}
c_p_sat_w <- 1.8844e3
c_p_sat_l <- 4.2199e3
c_p_sat <- c_p_sat_w - c_p_sat_l

#' Return humidity ratio given dry-bulb temperature, wet-bulb temperature, and pressure.
#' 
#' This formula only works for temperatures starting from the freezing point of water up.
#'
#' @param T_d_ A numeric vector of dry-bulb temperature in degreeF [IP] or degreeC [SI]
#' @param T_w_ A numeric vector of wet-bulb temperature in degreeF [IP] or degreeC [SI]
#' @param method the method of calculation: "ASHRAE" or "FAO"
#'
#' @return A numeric vector of humidity ratio in lb_H2O lb_Air-1 [IP] or kg_H2O kg_Air-1 [SI]
#'
#' @references
#' ASHRAE Handbook - Fundamentals (2017) ch. 1 eqn 33 and 35
#'
#' @examples
#' calculate_W(20:30, 19.0, 95461.0)
#'
#' @export
calculate_W <- function(T_d, T_w, method) {
  
  if (is.null(method)) {
    stop("The method must be either \"ASHRAE\" or \"FAO\". The method is currently not set.")
  } else if ("ASHRAE" == method | "FAO" == method) {
    Wsstar <- calculate_W_saturated(T_w, method = method)
  } else {
    stop(paste("The method must be either \"ASHRAE\" or \"FAO\". The method is currently", method, "."))
  }

  t_d <- GetTCelsiusFromTKelvin(T_d)
  t_w <- GetTCelsiusFromTKelvin(T_w)
  W <- (Wsstar * (delta_vap_h - c_p_sat * t_w) - c_p_d * (t_d - t_w)) / (delta_vap_h + c_p_sat_w * t_d - c_p_sat_l * t_w)
  return(signif(W, digits = 5))
}

#' Return vapor pressure given humidity ratio and pressure.
#'
#' @param HumRatio A numeric vector of humidity ratio in kg_H2O kg_Air-1 [SI]
#' @param Pressure A numeric vector of atmospheric pressure in Pa [SI]
#'
#' @return A numeric vector of partial pressure of water vapor in moist air in Pa [SI]
#'
#' @export
calculate_P_from_W <- function(W) {
    return(p_at * W / (M_w_TO_M_d + W))
}

```

```{=tex}
\begin{landscape}
```

Avaldan küllastusentalpia valemist \@ref(eq:enthalpy-of-saturated-air) leheküljel $\pageref{eq:enthalpy-of-saturated-air}$ niiskuse suhte:

```{=tex}
\begin{align}
&c_p(\text{d}) \times (T_\text{d} - \qty{`r T_0`}{\kelvin}) + W \times (\Delta_\text{vap}(h) + c_p(\text{sat, w}) \times (T_\text{d} - \qty{`r T_0`}{\kelvin}))\\
&+ W_\text{sat} \times c_p(\text{sat, l}) \times (T_w - \qty{`r T_0`}{\kelvin}) - W \times c_p(\text{sat, l}) \times (T_w - \qty{`r T_0`}{\kelvin})\\
&= c_p(\text{d}) \times (T_\text{w} - \qty{`r T_0`}{\kelvin}) + W_\text{sat} \times (\Delta_\text{vap}(h) + c_p(\text{sat, w}) \times (T_\text{w} - \qty{`r T_0`}{\kelvin}))\\
&W \times (\Delta_\text{vap}(h) + c_p(\text{sat, w}) \times (T_\text{d} - \qty{`r T_0`}{\kelvin}) - c_p(\text{sat, l}) \times (T_\text{w} - \qty{`r T_0`}{\kelvin})) \\
&= c_p(\text{d}) \times (T_\text{w} - \qty{`r T_0`}{\kelvin}) + W_\text{sat} \times (\Delta_\text{vap}(h) + c_p(\text{sat, w}) \times (T_\text{w} - \qty{`r T_0`}{\kelvin}))\\
&- c_p(\text{d}) \times (T_\text{d} - \qty{`r T_0`}{\kelvin}) - W_\text{sat} \times c_p(\text{sat, l}) \times (T_\text{w} - \qty{`r T_0`}{\kelvin})\\
&= c_p(\text{d}) \times (T_\text{w} - T_\text{d}) + W_\text{sat} \times (\Delta_\text{vap}(h) + c_p(\text{sat, w}) \times (T_\text{w} - \qty{`r T_0`}{\kelvin}) - c_p(\text{sat, l}) \times (T_\text{w} - \qty{`r T_0`}{\kelvin}))\\
&W := \frac{c_p(\text{d}) \times (T_\text{w} - T_\text{d}) + W_\text{sat} \times (\Delta_\text{vap}(h) + c_p(\text{sat, w}) \times (T_\text{w} - \qty{`r T_0`}{\kelvin}) - c_p(\text{sat, l}) \times t_\text{w}}{\Delta_\text{vap}(h) + c_p(\text{sat, w}) \times (T_\text{d} - \qty{`r T_0`}{\kelvin}) - c_p(\text{sat, l}) \times (T_\text{w} - \qty{`r T_0`}{\kelvin})}\\
&W := \frac{c_p(\text{d}) \times (T_\text{w} - T_\text{d}) + W_\text{sat} \times (\Delta_\text{vap}(h) + (c_p(\text{sat, w}) - c_p(\text{sat, l})) \times (T_\text{w} - \qty{`r T_0`}{\kelvin}))}{\Delta_\text{vap}(h) + c_p(\text{sat, w}) \times (T_\text{d} - \qty{`r T_0`}{\kelvin}) - c_p(\text{sat, l}) \times (T_\text{w} - \qty{`r T_0`}{\kelvin})}\\
&W\\
&:= \frac{\qty{`r c_p_d`}{\joule\per\kilogram\per\kelvin} \times (T_\text{w} - T_\text{d}) + W_\text{sat} \times (`r delta_vap_h` \times \unit{\joule\per\kilogram} + (\qty{`r c_p_sat_w`}{\joule\per\kilogram\per\kelvin} - \qty{`r c_p_sat_l`}{\joule\per\kilogram\per\kelvin}) \times (T_\text{w} - \qty{`r T_0`}{\kelvin}))}{`r delta_vap_h` \times \unit{\joule\per\kilogram} + \qty{`r c_p_sat_w`}{\joule\per\kilogram\per\kelvin} \times (T_\text{d} - \qty{`r T_0`}{\kelvin}) - \qty{`r c_p_sat_l`}{\joule\per\kilogram\per\kelvin} \times (T_\text{w} - \qty{`r T_0`}{\kelvin})}\\
&W := \frac{W_\text{sat} \times (`r delta_vap_h` \times \unit{\joule\per\kilogram} + \qty{`r c_p_sat`}{\joule\per\kilogram\per\kelvin} \times (T_\text{w} - \qty{`r T_0`}{\kelvin})) - \qty{`r c_p_d`}{\joule\per\kilogram\per\kelvin} \times (T_\text{d} - T_\text{w})}{`r delta_vap_h` \times \unit{\joule\per\kilogram} + \qty{`r c_p_sat_w`}{\joule\per\kilogram\per\kelvin} \times (T_\text{d} - \qty{`r T_0`}{\kelvin}) - \qty{`r c_p_sat_l`}{\joule\per\kilogram\per\kelvin} \times (T_\text{w} - \qty{`r T_0`}{\kelvin})}
(\#eq:humidity-ratio-using-enthalpies)
\end{align}
``` 

[@haynes_2014_crc, pp. 6-1, 6-15].

```{=tex}
\end{landscape}
```

Korraldan kogurõhu valemis \@ref(eq:total-pressure) leheküljel $\pageref{eq:total-pressure}$ asju ümber ning asendan uude valemisse suhtelise niiskuse valemist \@ref(eq:relative-humidity-as-ratio-of-pressure) leheküljel $\pageref{eq:relative-humidity-as-ratio-of-pressure}$ ja küllastusastme valemist \@ref(eq:degree-of-saturation) leheküljel $\pageref{eq:degree-of-saturation}$, misjärel asendan niiskuse suhte küllastusastme valemist ja avaldan küllastusastme:

```{=tex}
\begin{align}
\frac{(`r M_w_TO_M_d` + W) \times p_\text{w}}{p_\text{sat}(\text{w})} &= \frac{(`r M_w_TO_M_d` + W_\text{sat}) \times W}{W_\text{sat}}\\
RH \times (`r M_w_TO_M_d` + W) &= \mu \times (`r M_w_TO_M_d` + W_\text{sat})\\
RH \times (`r M_w_TO_M_d` + \mu \times W_\text{sat}) &= \mu \times (`r M_w_TO_M_d` + W_\text{sat})\\
RH \times `r M_w_TO_M_d` + RH \times \mu \times W_\text{sat} &= \mu \times (`r M_w_TO_M_d` + W_\text{sat})\\
RH \times \mu \times W_\text{sat} - \mu \times (`r M_w_TO_M_d` + W_\text{sat}) &= -RH \times `r M_w_TO_M_d`\\
\mu \times (RH \times W_\text{sat} - `r M_w_TO_M_d` - W_\text{sat}) &= -RH \times `r M_w_TO_M_d`\\
\mu \times (W_\text{sat} \times (RH - 1) - `r M_w_TO_M_d`) &= -RH \times `r M_w_TO_M_d`\\
\mu :&= \frac{RH \times `r M_w_TO_M_d`}{`r M_w_TO_M_d` - W_\text{sat} \times (RH - 1)}\\
\mu :&= \frac{RH \times `r M_w_TO_M_d`}{`r M_w_TO_M_d` + W_\text{sat} \times (1 - RH)}\\
\mu :&= \frac{RH}{1 + \frac{W_\text{sat} \times (1 - RH)}{`r M_w_TO_M_d`}}
(\#eq:degree-of-saturation-from-pressure)
\end{align}
``` 

[@numerically-degree-of-saturation].

Kirjutan niiskuse suhte põhivalemi \@ref(eq:humidity-ratio) leheküljel $\pageref{eq:humidity-ratio}$ veidi ümber ja teen vastava asenduse küllastusastme valemisse \@ref(eq:degree-of-saturation-from-pressure), misjärel avaldan tulemusest suhtelise niiskuse:

```{=tex}
\begin{align}
\frac{W}{`r M_w_TO_M_d`} &= \frac{p_\text{w}}{p - p_\text{w}}\\
\mu :&= \frac{RH}{1 + \frac{p_\text{w} \times (1 - RH)}{p - p_\text{w}}}\\
\mu + \frac{\mu \times p_\text{w} \times (1 - RH)}{p - p_\text{w}} &= RH\\
\mu \times p - \mu \times p_\text{w} + \mu \times p_\text{w} - \mu \times p_\text{w} \times RH &= RH \times p - RH \times p_\text{w}\\
RH \times (p - p_\text{w} + \mu \times p_\text{w}) &= \mu \times (p \cancel{- p_\text{w}} \cancel{+ p_\text{w}})\\
RH :&= \frac{\mu \times p}{p + p_\text{w} \times (\mu - 1)}\\
RH :&= \frac{\mu}{1 + \frac{p_\text{w} \times (\mu - 1)}{p}}
(\#eq:relative-humidity-from-degree-of-saturation)
\end{align}
``` 

[@numerically-relative-humidity], [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 15].
```{r label = "dew-point"}

#' This function calculates the dew point temperature between 273.15 K and 366.15 K.
#'
#' @param T_d the dry bulb temperature
#' @param T_w the wet bulb temperature
#' @param method_for_dew either "universal from humidity ratio", "universal from pressure", "with psychrometer" or "without psychrometer"
#' @param method_for_p the method of calculation: "ASHRAE" or "FAO"
#' @param gamma the psychrometric coefficient
#' 
#' @return the dew point temperature
#' 
#' @export
calculate_Tdp <- function(T_d, T_w, method_for_dew, method_for_p, gamma = NULL) {

  if (is.null(method_for_dew)) {
    stop("The method for calculating the dew point must be either \"universal from humidity ratio\", \"universal from pressure\", \"with psychrometer\" or \"without psychrometer\". The current method isn't set.")
  } else if (is.null(method_for_p)) {
    stop("The method must be either \"ASHRAE\" or \"FAO\". The method is currently not set.")
  } else if ("universal from humidity ratio" == method_for_dew) {
    W <- calculate_W(T_d, T_w, method = method_for_p)
    p_w <- calculate_P_from_W(W) / 1e3
    print(p_w)
    alpha <- log(p_w)
    T_dew <- 6.54 + 14.526 * alpha + .7389 * alpha^2 + .09486 * alpha^3 + .4569 * p_w^.1984
  } else if ("universal from pressure" == method_for_dew) {
    p_sat <- calculate_p_sat(T_w, method = method_for_p)
    
    if (is.null(gamma)) {
      gamma <- calculate_gamma(p_at)
    }

    p_w <- calculate_p_a(p_sat, gamma, T_d, T_w) / 1e3
    alpha <- log(p_w)
    T_dew <- 6.54 + 14.526 * alpha + .7389 * alpha^2 + .09486 * alpha^3 + .4569 * p_w^.1984
  } else if ("with psychrometer" == method_for_dew) {
    
    if (is.null(gamma)) {
      gamma <- calculate_gamma(p_at)
    }
    
    p_sat_at_T_w <- calculate_p_sat(T_w, method = method_for_p)
    T_dew <- (112 + .9*(T_w - T_0)) * (calculate_p_a(p_sat_at_T_w, gamma, T_d, T_w) / p_sat_at_T_w)^(1/8) - 112 + .1 * (T_w - T_0)
  } else if ("without psychrometer" == method_for_dew) {
    
    if (is.null(gamma)) {
      gamma <- calculate_gamma(p_at)
    }

    p_sat_at_T_w <- calculate_p_sat(T_w, method = method_for_p)
    log_of_p_a <- log(calculate_p_a(p_sat_at_T_w, gamma, T_d, T_w) * 1e-3)
    T_dew <- (116.91 + 237.3 * log_of_p_a) / (16.78 - log_of_p_a)
  } else {
    stop(paste("The method for calculating the dew point must be either \"universal from humidity ratio\", \"universal from pressure\", \"with psychrometer\" or \"without psychrometer\". The current method is", method_for_dew, "."))
  }

  return(signif(T_dew + T_0, digits = 5))
}

```

```{r label = "t-dp"}
T_1 <- GetTKelvinFromTCelsius(93)
```

Kastepunkti valem kehtib vahemikus $\qty{`r T_0`}{\kelvin}$ kuni $\qty{`r T_1`}{\kelvin}$:

```{=tex}
\begin{align}
T_\text{dew} :&= (6.54 + 14.526 \times \text{ln}(\frac{p_\text{w}}{10^3 \times \unit{\pascal}}) + .7389 \times (\text{ln}(\frac{p_\text{w}}{10^3 \times \unit{\pascal}}))^2 + .09486 \times (\text{ln}(\frac{p_\text{w}}{10^3 \times \unit{\pascal}}))^3\\
&+ .4569 \times \frac{p_\text{w}}{10^3 \times \unit{\pascal}}^{.1984} + 273.15) \times \unit{\kelvin}
(\#eq:dew-point-temperature)
\end{align}
``` 

[@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 16].

@inbook, p. 226 esitatakse kastepunkti arvutamiseks kaks valemit. Üks valem on üldine ja olukorra kohta, milles ei mõõdeta temperatuuri:

```{=tex}
\begin{align}
T_\text{dew} := (\frac{116.91 + 237.3 \times \text{ln}(\frac{p_\text{a} \times 10^3}{\unit{\pascal}})}{16.78 - \text{ln}(\frac{p_\text{a} \times 10^3}{\unit{\pascal}})} + \qty{`r T_0`}) \times \unit{\kelvin}.
(\#eq:dew-point-temperature-inbook-without-observation)
\end{align}
``` 

Teine valem on kasutatav koos psühromeetriga:

```{=tex}
\begin{align}
T_\text{dew} := (\qty{112}{\kelvin} + 0.9 \times T_\text{w}) \times (\frac{p_\text{a}}{p_\text{sat}(T_\text{w})})^\frac{1}{8} - \qty{112}{\kelvin} + 0.1 \times T_\text{w} + \qty{`r T_0`}{\kelvin}.
(\#eq:dew-point-temperature-inbook-with-psychrometer)
\end{align}
``` 

Kim Wilde on võrrelnud meenutust kastepunktiga laulus *Water On Glass* [@kim].

## Eriruumala

Eriruumala põhivalem, mille rakendamisel niiske õhu segu kohta on massiks kuiva õhu mass:

```{=tex}
\begin{align}
v := \frac{V}{m},
(\#eq:specific-volume)
\end{align}
``` 

milles *V* on ruumala [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 15], [@numerically-specific-volume]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{L^3}{M}},
(\#eq:dimensional-analysis-for-specific-volume)
\end{align}
``` 

mis tähendab, et ühik on $\unit{\cubic\meter\per\kilogram}$.
```{r label = "molar-mass-of-dry-air-to-molar-mass-of-water-vapor"}
M_d_TO_M_w <- 1 / M_w_TO_M_d

```

Asendan niiske õhu segu eriruumala põhivalemisse \@ref(eq:specific-volume) leheküljel $\pageref{eq:specific-volume}$ massi ainehulga valemist \@ref(eq:molar-mass) leheküljel $\pageref{eq:molar-mass}$, molaarmassi ideaalse gaasi konstandi ja kuiva õhu gaasikonstandi jagatisega gaasi erikonstandi valemist \@ref(eq:specific-gas-constant) leheküljel $\pageref{eq:specific-gas-constant}$, ainehulga ideaalse gaasi rõhu valemist \@ref(eq:pressure-of-ideal-gas) leheküljel $\pageref{eq:pressure-of-ideal-gas}$, veeauru osarõhu vastavast niiskuse suhte valemist \@ref(eq:partial-vapor-pressure-from-humidity-ratio) leheküljel $\pageref{eq:partial-vapor-pressure-from-humidity-ratio}$:

```{=tex}
\begin{align}
v :&= \frac{V}{M_d \times n_d} = \frac{V \times r_\text{d}}{R \times n_d} = \frac{\cancel{V} \times r_\text{d} \times \cancel{R} \times T}{\cancel{R} \times p_\text{d} \times \cancel{V}} = \frac{r_\text{d} \times T}{p_\text{d}} = \frac{r_\text{d} \times T}{p - p_\text{w}}\\
&= \frac{r_\text{d} \times T}{p - \frac{p \times W}{W + `r M_w_TO_M_d`}} = \frac{r_\text{d} \times T}{\frac{p \times (W + `r M_w_TO_M_d`) - p \times W}{W + `r M_w_TO_M_d`}} = \frac{r_\text{d} \times T \times (W + `r M_w_TO_M_d`)}{p \times (W + `r M_w_TO_M_d`) - p \times W}\\
&= \frac{r_\text{d} \times T \times (W + `r M_w_TO_M_d`)}{`r M_w_TO_M_d` \times p} = \frac{\frac{r_\text{d} \times T \times W}{`r M_w_TO_M_d`} + r_\text{d} \times T}{p} = \frac{r_\text{d} \times T \times (`r M_d_TO_M_w` \times W + 1)}{p}
(\#eq:specific-volume-from-humidity-ratio)
\end{align}
``` 

[@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 15], [@numerically-specific-volume].
