# Reeglid

## Jõud

```{=tex}
\begin{align}
\vec{F} := m \cdot \vec{a},
(\#eq:force)
\end{align}
```

kus *m* on mass ja *a* on kiirendus [@haynes_2014_crc, p. 2-2]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{M \cdot \frac{L}{T^2} = \frac{L \cdot M}{T^2}},
(\#eq:dimensional-analysis-for-force)
\end{align}
```

mistõttu ühik on $\unit{\meter\kilogram\per\second\squared}$ või lühemalt $\unit{\newton}$.

## Temperatuur


```{=tex}
\begin{align}
T := t + 237.15,
(\#eq:absolute-temperature)
\end{align}
```

mille ühik on $\unit{\kelvin}$ [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 8].

## Rõhk

```{=tex}
\begin{align}
p := \frac{F}{A} = \frac{m \cdot a}{A},
(\#eq:pressure)
\end{align}
```

kus *A* on pindala [@haynes_2014_crc, p. 2-2]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{L \cdot M}{T^2 \cdot L^2} = \frac{M}{T^2 \cdot L}},
(\#eq:dimensional-analysis-for-pressure)
\end{align}
```

mistõttu ühik on $\unit{\kilogram\per\second\squared\per\meter}$ või lühemalt $\unit{\pascal}$.


```{r label = "pressure"}
p <- 100e3
p_at <- 101.325e3
```

standardseisund
: määratletud olek (määratud temperatuur, rõhk, kontsentratsioon jne) termodünaamiliste funktsioonide tabeleerimiseks ja termodünaamiliste arvutuste tegemiseks [@haynes_2014_crc, p. 2-65]

Standardseisundi rõhk on `r p` $\unit{\pascal}$ [@haynes_2014_crc, p. 1-7]. Standardne atmosfäär on `r p_at` $\unit{\pascal}$.

Ideaalse gaasi rõhk:
```{r label = "r"}
R <- 8314.472e-3
```

```{=tex}
\begin{align}
p := \frac{n \cdot R \cdot T}{V},
(\#eq:pressure-of-ideal-gas)
\end{align}
```

milles *n* on ainehulk, *R* on universaalne gaasikonstant $`r R` \times \unit{\joule\per\mole\per\kelvin}$ ja *V* on ruumala [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 14]. Dimensionaalanalüüs:


```{=tex}
\begin{align}
\frac{\mathrm{N} \cdot \frac{\mathrm{L^2 \cdot M}}{\mathrm{T^2 \cdot N} \cdot \Theta} \cdot \Theta}{\mathrm{L^3}} = \mathrm{\frac{M}{L \cdot T^2}},
(\#eq:dimensional-analysis-for-pressure-of-ideal-gas)
\end{align}
```

mistõttu ühik on $\unit{\kilogram\per\meter\per\second\squared}$ ehk lühemalt $\unit{\pascal}$.

Küllastusrõhk vedela vee kohal temperatuurivahemikus 0 kuni 200°C on antud valemiga

```{=tex}

\begin{align}
& p_{ws} && := e^{\sum_{i := 8}^{n}{C_i \times T^{i - 9}} + 6.5459673 \times \mathrm{ln}(T)}\\
&&&= e^{\sum_{i := 8}^n{C_i \times (t + 273.15)^{i - 9}} + 6.5459673 \times \mathrm{ln}(t + 273.15)}\text{, kus}\\
& C_8 && := -5.8002206 \times 10^3,\\
& C_9 && := 1.3914993,\\
& C_{10} && := -4.8640239 \times 10^{-2},\\
& C_{11} && := 4.1764768 \times 10^{-5},\\
& C_{12} && := -1.4452093 \times 10^{-8}
(\#eq:saturation-pressure-over-liquid-h2o)
\end{align}

```

milles *T* on absoluutne temperatuur [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 14].

## Energia, töö, soojushulk


```{=tex}
\begin{align}
E := \int{\vec{F}} \cdot \mathrm{d}(s) = \int{m \cdot \vec{a}} \cdot \mathrm{d}(s),
(\#eq:energy)
\end{align}
```

milles $\mathrm{d}(s)$ on lõputult väike nihe [@haynes_2014_crc, p. 2-2]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{L \cdot M}{T^2} \cdot L = \frac{L^2 \cdot M}{T^2}},
(\#eq:dimensional-analysis-for-energy)
\end{align}
```

mistõttu ühik on $\unit{\frac{m^2 \cdot kg}{s^2}}$ või lühemalt $\unit{m \cdot N}$ või veelgi lühemalt $\unit{J}$.

Siseenergia muut:

```{=tex}
\begin{align}
\Delta(U) = q + E
(\#eq:internal-energy)
\end{align}
```

[@Mills1993-oj, p. 56]

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{L^2 \cdot M}{T^2}},
(\#eq:dimensional-analysis-for-internal-energy)
\end{align}
```

mille põhjal on ühik $\unit{\frac{m^2 \cdot kg}{s^2}}$ või lühemalt $\unit{m \cdot N}$ või veelgi lühemalt $\unit{J}$.

Entalpia:

```{=tex}
\begin{align}
H := U + p \cdot V
(\#eq:enthalpy)
\end{align}
```

[@Mills1993-oj, p. 56]. Dimensionaalanalüüs:


```{=tex}
\begin{align}
\mathrm{\frac{L^2 \cdot M}{T^2} + \frac{M}{L \cdot T^2} \cdot L^3 = \frac{L^2 \cdot M}{T^2}},
(\#eq:dimensional-analysis-for-enthalpy)
\end{align}
```

mille põhjal ühik on $\unit{\frac{m^2 \cdot kg}{s^2}}$ või lühemalt $\unit{m \cdot N}$ või veelgi lühemalt $\unit{J}$.

Erientalpia:

```{=tex}
\begin{align}
h := \frac{H}{m}
(\#eq:specific-enthalpy)
\end{align}
```

[@Mills1993-oj, p. 16]. Dimensionaalanalüüs:


```{=tex}
\begin{align}
\mathrm{\frac{L^2 \cdot M}{T^2 \cdot M} = \frac{L^2}{T^2}},
(\#eq:dimensional-analysis-for-specific-enthalpy)
\end{align}
```

mille põhjal ühik on $\unit{\frac{m^2}{s^2}}$ või lühemalt $\unit{\joule\per\kilogram}$.

Soojusmahtuvus konstantsel rõhul:

```{=tex}
\begin{align}
C_p := (\frac{\partial{H}}{\partial{T}})_p
(\#eq:heat-capacity)
\end{align}
```

[@Mills1993-oj, p. 56, @haynes_2014_crc, p. 2-69]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\frac{\mathrm{\frac{L^2 \cdot M}{T^2}}}{\Theta} = \frac{\mathrm{L^2 \cdot M}}{\mathrm{T^2} \cdot \Theta},
(\#eq:dimensional-analysis-for-heat-capacity)
\end{align}
```

mille põhjal ühik on $\unit{\meter\squared\kilogram\per\second\squared\per\kelvin}$ või lühemalt $\unit{\meter\newton\per\kelvin}$ või veelgi lühemalt $\unit{\joule\per\kelvin}$.

Erisoojus konstantsel rõhul:

```{=tex}
\begin{align}
c_p := \frac{C_p}{m}
(\#eq:specific-heat-capacity)
\end{align}
```

[@Mills1993-oj, p. 16, @haynes_2014_crc, pp. 2-55, 2-65]. Dimensionaalanalüüs:


```{=tex}
\begin{align}
\frac{\frac{\mathrm{L^2 \cdot M}}{\mathrm{T^2} \cdot \Theta}}{\mathrm{M}} = \frac{\mathrm{L^2}}{\mathrm{T^2} \cdot \Theta},
(\#eq:dimensional-analysis-for-specific-heat-capacity)
\end{align}
```

mille põhjal ühik on $\unit{\meter\squared\per\second\squared\per\kelvin}$ või lühemalt $\unit{\joule\per\kelvin\per\kilogram}$.


## Molaarmass

molaarmass
: aine ühe mooli mass [@haynes_2014_crc, p. 2-60]

```{=tex}
\begin{align}
M_\mathrm{B} := \frac{m}{n_\mathrm{B}},
(\#eq:molar-mass)
\end{align}
```

kus $n_\mathrm{B}$ on (aine)hulk [@haynes_2014_crc, p. 2-8]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{M}{N}},
(\#eq:dimensional-analysis-for-molar-mass)
\end{align}
```

mistõttu ühik on $\unit{\kilogram\per\mole}$.


Lähtemolaarmasside arvutamiseks kasutan [@Mills1993-oj, pp. 101-103, 105] andmeid:

```{r label = "molar-masses"}
M_H_1_TO_M_H <- 99.9851e-2
M_H <- (1.00782503512 * M_H_1_TO_M_H + 2.01410177924 * (1 - M_H_1_TO_M_H)) * 1e-3
M_He_1_TO_M_He <- 0.0001373e-2
M_He <- (3.016029314 * M_He_1_TO_M_He + 4.00260325 * (1 - M_He_1_TO_M_He)) * 1e-3
M_C_1_TO_M_C <- 98.903e-2
M_C <- (12 *  M_C_1_TO_M_C + 13.00335482617 * (1 - M_C_1_TO_M_C)) * 1e-3
M_N_1_TO_M_N <- 99.635e-2
M_N <- (14.00307400226 * M_N_1_TO_M_N + 15.000108974 * (1 - 99.635e-2)) * 1e-3
M_O_TO_M_O <- c(99.76215e-2, 0.0383e-2)
M_O <- (15.994914636 * M_O_TO_M_O[1]  + 16.99913124 * M_O_TO_M_O[2] + 17.9991604 * (1 - sum(M_O_TO_M_O))) * 1e-3
M_Ne_TO_M_Ne <- c(90.483e-2, 0.271e-2)
M_Ne <- (19.992435622 * M_Ne_TO_M_Ne[1] + 20.993842821 * M_Ne_TO_M_Ne[2]  + 21.991383118 * (1 - sum(M_Ne_TO_M_Ne))) * 1e-3
M_Ar_TO_M_Ar <- c(0.3373e-2, 0.0631e-2)
M_Ar <- (35.9675455229 * M_Ar_TO_M_Ar[1] + 37.9627326 * M_Ar_TO_M_Ar[2] + 39.962383714 * (1 - sum(M_Ar_TO_M_Ar))) * 1e-3
M_Kr_TO_M_Kr <- c(0.352e-2, 2.252e-2, 11.61e-2, 11.51e-2, 57.03e-2)

M_Kr <- (77.920397 * M_Kr_TO_M_Kr[1] + 79.916381 * M_Kr_TO_M_Kr[2] + 81.913483 * M_Kr_TO_M_Kr[3] + 82.9141354 * M_Kr_TO_M_Kr[4] + 83.9115074 * M_Kr_TO_M_Kr[5] + 85.910617 * (1 - sum(M_Kr_TO_M_Kr))) * 1e-3

M_Xe_TO_M_Xe <- c(0.101e-2, 0.091e-2, 1.913e-2, 26.5e-2, 4.11e-2, 21.24e-2, 27e-2, 10.42e-2)

M_Xe <- (123.90589422 * M_Xe_TO_M_Xe[1] + 125.904282 * M_Xe_TO_M_Xe[2] + 127.9035312172 * M_Xe_TO_M_Xe[3] + 128.904780121 * M_Xe_TO_M_Xe[4] + 129.9035094172 * M_Xe_TO_M_Xe[5] + 130.905073 * M_Xe_TO_M_Xe[6] + 131.904145 * M_Xe_TO_M_Xe[7] + 133.905396 * M_Xe_TO_M_Xe[8] + 135.907215 * (1 - sum(M_Xe_TO_M_Xe))) * 1e-3

M_H2O <- M_H * 2 + M_O
M_H2O_haynes <- 18.015268e-3

M_air <- 28.966e-3

```

Vee molaarmass on vastavalt [@haynes_2014_crc, p. 6-9] $`r M_H2O_haynes` \times \unit{\kilogram\per\mole}$ ning minu arvutustele $`r M_H2O` \times \unit{\kilogram\per\mole}$. Kuna enda äralöök on kindlam kui loodetav vastase aut, siis kasutan edaspidi arvutustes enda arvutusi, kui pole sätestatud teisiti.

Õhu molaarmassi saaks ka otse teatmikust võtta, aga tahan ikkagi näidata, millest see on kokku arvutatud. Õhk koosneb mitmest komponendist, millest kõik peale süsihappegaasi ja hapniku on piisavalt püsiva osalusega. Süsihappegaasi sisaldus õhus varieerub pidevalt. Mida rohkem on õhus süsihappegaasi, seda vähem on kuivas õhus hapnikku ja vastupidi, sest põlemises liidab süsinik endaga dihapniku õhust. Õhu molaarmass muutub seega sõltuvalt sellest, kui palju süsinikku kas õhku lisandub või sellest eraldub. Praegu elame perioodis, milles süsinikku kuiva õhku lisandub. Õhu koostist, muuhulgas süsinikdioksiidi sisaldust mõõdetakse iga tund. Leidsin Barrow Atmospheric Baseline Observatory' andmed, mis on kogutud $\qty{27}{\meter}$ kõrguselt, mis on umbes see kõrgus, kus me oma eksperimente tegime ja mis on kõige kaasaegsemad [@NOAA_GML_CCGG_Group2019-oq]. Kuigi [@RN23688432420080101, p. 1] mainitakse, et praktiline oleks kasutada selliste andmete põhjal tehtud projektsioonväärtust, samas kurdetakse, et aktuaalset väärtust on keeruline leida [@RN23688432420080101, p. 3], soovin mina kasutada viimati väljamõõdetud väärtust, sest sellest pole liiga palju aega möödunud. Viimatised andmed on nimelt pärit 2021. aasta viimasest päevast, millest praeguse aruande kirjutamiseni on möödas veidi üle poole aasta. Süsinikdioksiidi osa kuivas õhus aastais 1973 kuni 2021 on esitatud joonisel \@ref(fig:co2-in-air).

(ref:x-citation) @Mills1993-oj, p. 84

```{r label = "co2-in-air", fig.cap="Süsinikdioksiidi osa kuivas õhus aastais 1973 kuni 2021 ((ref:x-citation))."}
CO2_in_air <- read.table("co2_brw_surface-insitu_1_ccgg_DailyData.txt", header = TRUE, sep = "", dec = ".")

librarian::shelf(
  ggplot2,
  latex2exp
)

CO2_in_air <- subset(CO2_in_air, value > -999.99)

ggplot(data = CO2_in_air, aes(x = time_decimal, y = value)) + geom_point() +
  labs(x = TeX("$\\frac{t}{s}$"), y = TeX("$\\frac{x \\times 10^{-6}}{\\frac{mol({CO_2})}{mol(air)}}$"))
```


Õhu molaarmassi võib võtta teatmikust, aga võib ka õhu koostisosade molaarmasside põhjal ise arvutada, et näha, millest õhu molaarmass koosneb. [@haynes_2014_crc, p. 6-164] põhjal esinevad lämmastik, hapnik ja vesinik kaksikaatomist koosneva lihtainena. Õhu koostis on üldiselt püsiv, kuid seda mõjutab süsihappe gaasi poolt hapniku asendamine. Viimast 

(ref:m-trace-citation) @RN23688432420080101, p. 4

```{r label = "consistence-of-air"}
SUBSTANCE <- c(
  "$\\ce{N_2}$",
  "$\\ce{O_2}$",
  "$\\ce{Ar}$",
  "$\\ce{CO_2}$",
  "$\\ce{Ne}$",
  
  "$\\ce{He}$",
  "$\\ce{Kr}$",
  "$\\ce{Xe}$",
  "$\\ce{CH_4}$",
  "$\\ce{H_2}$",
  
  "$\\ce{N_2O}$",
  "$\\ce{CO}$"
)

M_O2 <- M_O * 2
M_N2 <- M_N * 2

M <- c(
  M_N2,
  M_O2,
  M_Ar,
  M_C + M_O2,
  M_Ne,
  
  M_He,
  M_Kr,
  M_Xe,
  M_C + M_H * 4,
  M_H * 2,
  
  M_N2 + M_O,
  M_C + M_O
)

x_CO2 <- 420.99
DELTA_CO2 <- x_CO2 - 385
PART <- c(
  780818,
  209435 - DELTA_CO2,
  9332,
  x_CO2,
  18.2,

  5.2,
  1.1,
  .1,
  1.5,
  .5,

  .3,
  .2
)

M_psi <- M * PART

composition_of_air <- data.frame(SUBSTANCE, M, PART, M_psi)
mean_trace <- mean(M[5:length(M)])
psi_trace <- 1e6 - sum(PART)

colnames(composition_of_air) <- c(
  "Koostisosa",
  "Molaarmass $\\frac{M}{\\unit{\\kilogram\\per\\mol}}$",
  "Moolifraktsioon $\\frac{\\psi}{\\unit{\\micro\\mole(\\text{i})\\per\\mole(\\text{air})}}$",
  "Osalus molaarmassis $\\frac{M \\cdot \\psi}{\\unit{\\milli\\gram\\per\\mole}}$"
)

librarian::shelf(
  "dplyr",
  "janitor",
  "kableExtra"
)


composition_of_air <- arrange(composition_of_air, desc(`Osalus molaarmassis $\\frac{M \\cdot \\psi}{\\unit{\\milli\\gram\\per\\mole}}$`))


composition_of_air[nrow(composition_of_air) + 1, ] <- c(
  "ülejäänud jälgained",
  mean_trace,
  psi_trace,
  mean_trace * psi_trace
)

composition_of_air[, 2:4] <- as.numeric(unlist(composition_of_air[, 2:4]))


composition_of_air_with_totals <- adorn_totals(dat = composition_of_air, name = "Kokku", where = "row", fill = "", na.rm = TRUE, c(3, 4))
M_air_2008 <- 28.965369e-3
M_air <- composition_of_air_with_totals[nrow(composition_of_air_with_totals), 4] * 1e-6
delta_M_air <- (M_air - M_air_2008)

print_table(
  data_frame = composition_of_air_with_totals,
  caption = "Kuiva õhu koostis.",
  digits = 3
) %>%
  column_spec(4, width = "6em") %>%
  footnote(number = c(
    paste("Süsinikdioksiidi molaarmass on 2021. aasta lõpu seisuga $\\\\qty{", DELTA_CO2, "}{\\\\kilogram\\\\per\\\\mole}$ võrra suurem kui 2008. aastas, mistõttu on õhu molaarmass $\\\\qty{", signif(delta_M_air, digits = 2), "}{\\\\kilogram\\\\per\\\\mole}$ võrra suurem."),
    "Ülejäänud jälgainete molaarmass on viimase kaheksa õhu komponendi ehk jälggaaside molaarmasside aritmeetiline keskmine, mis minu arvutustes erineb (ref:m-trace-citation) kirjapandud molaarmassist."
    ), escape = F, footnote_as_chunk = T, threeparttable = TRUE)

```


Kuiva õhu molaarmass on vastavalt minu arvutustele $\qty{`r M_air`}{\kilogram\per\mole}$, oli 2008. aastas vastavalt [@RN23688432420080101, p. 4]  $\qty{`r M_air_2008`}{\kilogram\per\mole}$, on vastavalt [@haynes_2014_crc, p. 6-164]

$$\mathrm{28.9655 \times \frac{\cancel{g}}{mol} \times \frac{10^{-3} \times kg}{1 \times \cancel{g}} = 2.89655 \times 10^{-2} \times \frac{kg}{mol}},$$

vastavalt  [@haynes_2014_crc, p. 14-21]

$$\mathrm{28.964 \times \frac{\cancel{g}}{mol} \times \frac{10^{-3} \times kg}{1 \times \cancel{g}} = 2.8964 \times 10^{-2} \times \frac{kg}{mol}}$$
ja vastavalt  [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 7]

$$\mathrm{28.966 \times \frac{\cancel{g}}{mol} \times \frac{10^{-3} \times kg}{1 \times \cancel{g}} = 2.8966 \times 10^{-2} \times \frac{kg}{mol}}.$$

## Massikontsentratsioon (massi tihedus)


```{=tex}
\begin{align}
γ_\mathrm{B} := \frac{m_\mathrm{B}}{V}
(\#eq:mass-concentration)
\end{align}
```

[@haynes_2014_crc, p. 2-8].

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{M}{L^3}},
(\#eq:dimensional-analysis-for-mass-concentration)
\end{align}
```

millest johtuvalt on ühik $\unit{\kilogram\per\cubic\metre}$.

Ideaalse gaasi tiheduse valemi loomiseks asendan ideaalse gaasi rõhu valemisse \@ref(eq:pressure-of-ideal-gas) leheküljel $\pageref{eq:pressure-of-ideal-gas}$ molaarmassi valemist \@ref(eq:molar-mass) leheküjel $\pageref{eq:molar-mass}$ ainehulga:


```{=tex}
\begin{align}
p :&= \frac{\frac{m}{M_\mathrm{B}} \cdot R \cdot T}{V}\\
p :&= \frac{m \cdot R \cdot T}{M_\mathrm{B} \cdot V}\\
\frac{m}{V} &= \frac{p \cdot M_\mathrm{B}}{R \cdot T} =: \gamma_\mathrm{B}.
(\#eq:mass-concentration-of-ideal-gas)
\end{align}
```

Dimensionaalanalüüs:


```{=tex}
\begin{align}
\mathrm{\frac{M}{L^3}} = \frac{\mathrm{\frac{M}{T^2 \cdot L} \cdot \frac{M}{N}}}{\frac{\mathrm{\frac{L^2 \cdot M}{T^2}}}{\mathrm{N} \cdot \Theta} \cdot \Theta} = \frac{\mathrm{M^2 \cdot N} \cdot \Theta}{\mathrm{T^2 \cdot L \cdot N \cdot \frac{L^2 \cdot M}{T^2}} \cdot \Theta},
(\#eq:dimensional-analysis-for-mass-concentration-of-ideal-gas)
\end{align}
```

mistõttu ühik on $\unit{\kilogram\per\cubic\meter}$.

Küllastava veeauru tiheduse arvutamiseks pistan rõhu küllastusrõhu valemist \@ref(eq:saturation-pressure-over-liquid-h2o) ideaalse gaasi tiheduse valemisse:

```{=tex}
\begin{align}
\gamma_\mathrm{B} &= \frac{e^{\sum_{i := 8}^n{C_i \times (t + 273.15)^{i - 9}} + 6.5459673 \times \mathrm{ln}(t + 273.15)} \cdot M_\mathrm{B}}{R \cdot T}.
(\#eq:density-of-saturated-h2o)
\end{align}
```
```{r label = "mass-concentration-t"}

librarian::shelf("psychrolib")

T_min <- GetTKelvinFromTCelsius(0)
T_max <- GetTKelvinFromTCelsius(200)
```

Lasen koostada tabeli \@ref(tab:density-of-saturated-h2o) küllastava veeauru tiheduse kohta vastavalt temperatuurile vahemikus $`r T_min` \times \unit{\kelvin}$ kuni $`r T_max` \times \unit{\kelvin}$:
```{r label = "density-of-saturated-h2o"}
t <- c(seq(0, 14, 2), seq(15, 27.9, .1), seq(28, 200, 4))
T <- GetTKelvinFromTCelsius(t)

calculate_p_H2O <- function(T) {
  
  for (index in 1:length(T)) {
  
    if (T[index] < 273.15 | T[index] > 473.15) {
      stop(paste("The absolute temperature must be between 273.15 and 473.15 K inclusive. The current absolute temperature at the position", index, "is", T[index], "K."))
    }
    
  }
  
  return(exp(-5.8002206e3 / T + 1.3914993 - 4.8640239e-2 * T + 4.1764768e-5 * T^2 - 1.4452093e-8 * T^3 + 6.5459673 * log(T)))
}

p_H2O <- calculate_p_H2O(T)

calculate_gamma_H2O <- function(p_H2O, T) {
  return(p_H2O * M_H2O / (R * T))
}

gamma_H2O <- calculate_gamma_H2O(calculate_p_H2O(T), T)

density_of_saturated_H2O <- data.frame(
  t,
  T,
  p_H2O,
  gamma_H2O
)

colnames(density_of_saturated_H2O) <- c(
  "$\\frac{\\text{Temperatuur}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{\\text{Absoluutne temperatuur}}{\\unit{\\kelvin}}$",
  "$\\frac{\\text{Rõhk}}{\\unit{\\pascal}}$",
  "$\\frac{\\text{Küllastava veeauru tihedus}}{\\unit{\\kilogram\\per\\cubic\\meter}}$"
)

print_table(density_of_saturated_H2O, caption = paste("Küllastava veeauru tihedused vahemikus", T_min, "$\\times \\unit{\\kelvin}$ kuni",  T_max, "$\\times \\unit{\\kelvin}$."), digits = 5)


```

Näeme jooniselt \@ref(fig:diagram-for-density-of-saturated-h2o), kuidas temperatuuri suurenedes eksponentsiaalselt suureneb küllastava veeauru tihedus. See tähendab, et mida soojem on õhk, seda rohkem veeauru õhku mahub. Inimesele sobivates tingimustes õhutemperatuuri puhul on küllastava veeauru tiheduse erinevus eri temperatuuridel peaaegu mittemärgatav ja nullilähedane.

```{r label = "diagram-for-density-of-saturated-h2o", fig.cap="Küllastava veeauru tiheduse sõltuvus temperatuurist."}
librarian::shelf(
  ggplot2,
  latex2exp
)

ggplot(data = density_of_saturated_H2O, aes(x = T, y = gamma_H2O)) +
  geom_point() +
  labs(x = TeX("$\\frac{T}{K}$"), y = TeX("$\\frac{\\gamma(H_2O)}{\\frac{kg}{m^3}}$"))

```

Näeme jooniselt \@ref(fig:diagram-for-pressure-of-saturated-h2o), kuidas temperatuuri suurenedes eksponentsiaalselt suureneb küllastava veeauru rõhk.


```{r label = "diagram-for-pressure-of-saturated-h2o", fig.cap="Küllastava veeauru rõhu sõltuvus temperatuurist."}
librarian::shelf(
  ggplot2,
  latex2exp
)

ggplot(data = density_of_saturated_H2O, aes(x = T, y = p_H2O)) +
  geom_point() +
  labs(x = TeX("$\\frac{T}{K}$"), y = TeX("$\\frac{p(H_2O)}{Pa}$"))

```


## Niiskus

niiskus
: õhus oleva vee massi suhe kuiva õhu massi [@a2018_determination]

kuivkolvi temperatuur
:  puhkeolekus mõõdetud niiskuse temperatuur, mida õhu niiskusesisaldus ega kiirgus ei mõjuta[@a2018_determination]

märgkolbi temperatuur
: dünaamiline tasakaalutemperatuur, mille veepind saavutab adiabaatilistes tingimustes õhuga kokkupuutel[@a2018_determination]

Absoluutne niiskus ehk rõhk kastepunktis:
```{r label = "rules-b"}
B <- .5 / 755
```

```{=tex}
\begin{align}
p_\text{dp} := p_\text{w} - (T_\text{d} - T_\text{w}) \cdot p \cdot B,
(\#eq:absolute-humidity)
\end{align}
```

milles *dp* tähendab kastepunkti, *w* märga ja *d* kuiva ning $B := `r B` \times \unit{\\per\\kelvin}$ [@Whipple_1933]. See absoluutse niiskuse arvutamise valem kehtib vedela vee kohta.

suhteline niiskus
: õhus oleva veeauru osarõhu ja vee küllastusauru rõhu suhe samal 
temperatuuril, väljendatud protsentides [@haynes_2014_crc, p. 2-63]

Suhtelise niiskuse valem:

```{=tex}
\begin{align}
RH := \frac{p_\text{dp}}{p_\text{d}}
(\#eq:relative-humidity)
\end{align}
```

[@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 15].

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{\frac{M}{L^3}}{\frac{M}{L^3}}} = 1.
(\#eq:dimensional-analysis-for-relative-humidity)
\end{align}
```

Tabelis \@ref(tab:rh) on esitatud väljaarvutatud suhteline niiskus valitud temperatuuride korral, mida saab võrrelda [@haynes_2014_crc, p. 15-32] tabeliga.

```{r label = "rh"}
calculate_RH <- function(p_dp, p_d_H2O) {
  return(p_dp / p_d_H2O)
}

calculate_p_dp <- function(p_w_H2O, T_d, T_w) {
  return(p_w_H2O - (T_d - T_w) * p_at / 1510)
}

t_d <- c(seq(10, 24, 1), seq(24.1, 27, .1), seq(28, 31, 1), seq(32, 48, 2), 49, seq(50, 200, 50))
T_d <- GetTKelvinFromTCelsius(t_d)
delta_T <- c(seq(1, 7, 1), seq(7.5, 9, .5), 9.4, 9.5, 10, 10.5, 10.8, 11, 12, 15)

calculate_RH_from_delta_T <- function(T_d, delta_T) {
  RH <- c()
  
  for (index in 1:length(T_d)) {
    T_w <- T_d[index] - delta_T
    
    if (T_w < 273.15) {
      RH <- c(RH, "")
    } else {
      p_w_H2O <- calculate_p_H2O(T_w)
      p_dp <- calculate_p_dp(p_w_H2O, T_d[index], T_w)
      p_d_H2O <- calculate_p_H2O(T_d[index])

      if (p_dp < 0) {
        RH <- c(RH, "")
      } else {
        
        RH <- c(RH, p_dp / p_d_H2O)
      }
      
    }
    
  }

  return(RH)
}

RH_T <- data.frame(T_d)
librarian::shelf("dplyr")

for (index in delta_T) {
  RH <- calculate_RH_from_delta_T(T_d = T_d, delta_T = index)
  RH_numeric <- as.numeric(RH)
  RH_T <- cbind(RH_T, ifelse(is.na(RH_numeric), "", round(RH_numeric * 100, digits = 1)))
}

colnames(RH_T) <- c(
  "$\\frac{T}{\\unit{\\kelvin}}$",
  delta_T
)

header_text <- c("Kuiva termomeetri näit", paste("Kuiva ja märja termomeetri näitude vahe $\\\\frac{\\\\Delta(T)}{\\\\unit{\\\\kelvin}}$"))
header_span <- c(1, 19)
header <- data.frame(header_text, header_span)

print_table(
  RH_T,
  caption = "Psühhomeetri tabel: sisuosas on esitatud suhteline õhuniiskus protsentides.",
  digits = 5,
  additional_header = header
) %>%
  column_spec(1, width = "6em") %>%
  landscape()

```

niiskuse suhe
: proovis oleva veeauru massi ja kuiva õhu massi suhe


```{r label = "W"}
M_w_TO_M_d <- M_H2O / M_air
#' Return humidity ratio of saturated air given dry-bulb temperature.
#'
#' @param T_d A numeric vector of dry-bulb temperature in [SI]
#'
#' @return A numeric vector of humidity ratio of saturated air in kg_H2O kg_Air-1 [SI]
#'
#' @references
#' ASHRAE Handbook - Fundamentals (2017) ch. 1 eqn 36, solved for W
#'
#' @examples
#' calculate_W(298.15)
#'
#' @export
calculate_W_saturated <- function(T_d) {
  
    if (T_d < 0) {
      stop(paste("The absolute temperature can't be negative. The current absolute temperature is", T_d, "K."))
    }

    p_H2O_saturated <- calculate_p_H2O(T_d)
    W_saturated <- M_w_TO_M_d * p_H2O_saturated / (p_at - p_H2O_saturated)
    return(W_saturated)
}

#' Return humidity ratio given dry-bulb temperature, wet-bulb temperature, and pressure.
#' 
#' This formula only works for temperatures starting from the freezing point of water up.
#'
#' @param T_d_ A numeric vector of dry-bulb temperature in degreeF [IP] or degreeC [SI]
#' @param T_w_ A numeric vector of wet-bulb temperature in degreeF [IP] or degreeC [SI]
#' @param c_p_d specific heat capacity of dry air
#'
#' @return A numeric vector of humidity ratio in lb_H2O lb_Air-1 [IP] or kg_H2O kg_Air-1 [SI]
#'
#' @references
#' ASHRAE Handbook - Fundamentals (2017) ch. 1 eqn 33 and 35
#'
#' @examples
#' SetUnitSystem("IP")
#' GetHumRatioFromTWetBulb(80:100, 77.0, 14.175)
#'
#' SetUnitSystem("SI")
#' GetHumRatioFromTWetBulb(20:30, 19.0, 95461.0)
#'
#' @export
calculate_W <- function(T_d, T_w, c_p_d) {

  if (any(T_w > T_d)) {
      stop(paste("Wet bulb temperature is above dry bulb temperature. The current wet bulb temperature is", T_w, "K and the current dry bulb temperature is", T_d, "K."))
  }

  t_d <- GetTCelsiusFromTKelvin(T_d)
  t_w <- GetTCelsiusFromTKelvin(T_w)
  
  Wsstar <- calculate_W_saturated(T_w)

  # W <- ((2501.0 - 2.326 * t_w) * Wsstar - 1.006 * (t_d - t_w)) / (2501.0 + 1.86 * t_d - 4.186 * t_w)

  W <- (c_p_d * (T_w - T_d) + Wsstar )
  return(W)
}

```


Kasutan niiskuse suhte valemis molaarmassi valemit \@ref(eq:molar-mass) ja edasi ideaalse rõhu gaasi valemit \@ref(eq:pressure-of-ideal-gas):

```{=tex}
\begin{align}
W := \frac{m(\ce{H_2O})}{m(\text{air})} =\frac{m_w}{m_d} = \frac{M_w \cdot n_w}{M_d \cdot n_d} = \frac{M_w \cdot p_w \cdot \cancel{V} \cdot \cancel{R} \cdot \cancel{T}}{\cancel{R} \cdot \cancel{T} \cdot M_d \cdot p_d \cdot \cancel{V}} = \frac{M_w \cdot p_w}{M_d \cdot p_d} = \frac{`r M_w_TO_M_d` \times p_w}{p - p_w}.
(\#eq:humidity-ratio)
\end{align}
``` 

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{\frac{M}{T^2 \cdot L}}{\frac{M}{T^2 \cdot L}}} = 1.
(\#eq:dimensional-analysis-for-humidity-ratio)
\end{align}
``` 


Niiske õhu erientalpia, millesse teen erientalpia asendused kasutades erientalpia üldvalemit \@ref(eq:enthalpy) ja erisoojuse valemit \@ref(eq:specific-enthalpy):

```{=tex}
\begin{align}
h := h_d + W \cdot h_g = c_p(\text{dry air}) \cdot T + W \cdot (\Delta_\text{vap}(h) + c_p(\text{sat, steam}) \cdot T)
(\#eq:enthalpy-of-moist-air)
\end{align}
``` 

[@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 15]. Dimensioonanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{L^2}{T^2}},
(\#eq:dimensional-analysis-for-enthalpy-of-moist-air)
\end{align}
``` 

mille põhjal ühik on $\unit{\frac{m^2}{s^2}}$ või lühemalt $\unit{\joule\per\kilogram}$.

Adiabaatilises protsessis küllastusentalpia:

```{=tex}
\begin{align}
h_\text{sat} :&= h + (W_\text{sat} - W) \cdot h_w = h_d + W \cdot h_g + (W_\text{sat} - W) \cdot h_w\\
&= c_p(\text{dry air}) \cdot T_d + W \cdot (\Delta_\text{vap}(h) + c_p(\text{sat, steam}) \cdot T_d) + (W_\text{sat} - W) \cdot c_p(\text{sat, liquid water}) \cdot T_w\\
&= c_p(\text{dry air}) \cdot T_w + W_\text{sat} \cdot (\Delta_\text{vap}(h) + c_p(\text{sat, steam}) \cdot T_w)
(\#eq:enthalpy-of-saturated-air)
\end{align}
``` 
[@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 15], [@numerically].

Avaldan küllastusentalpia valemist \@ref(eq:enthalpy-of-saturated-air) niiskuse suhte:

```{=tex}
\begin{align}
c_p(\text{dry air}) \cdot T_d + W \cdot (\Delta_\text{vap}(h) + c_p(\text{sat, steam}) \cdot T_d)\\
+ W_\text{sat} \cdot c_p(\text{sat, liquid water}) \cdot T_w - W \cdot c_p(\text{sat, liquid water}) \cdot T_w\\
= c_p(\text{dry air}) \cdot T_w + W_\text{sat} \cdot (\Delta_\text{vap}(h) + c_p(\text{sat, steam}) \cdot T_w)\\
W \cdot (\Delta_\text{vap}(h) + c_p(\text{sat, steam}) \cdot T_d - c_p(\text{sat, liquid water}) \cdot T_w) \\
= c_p(\text{dry air}) \cdot T_w + W_\text{sat} \cdot (\Delta_\text{vap}(h) + c_p(\text{sat, steam}) \cdot T_w)\\
- c_p(\text{dry air}) \cdot T_d - W_\text{sat} \cdot c_p(\text{sat, liquid water}) \cdot T_w\\
= c_p(\text{dry air}) \cdot (T_w - T_d) + W_\text{sat} \cdot (\Delta_\text{vap}(h) + c_p(\text{sat, steam}) \cdot T_w - c_p(\text{sat, liquid water}) \cdot T_w)\\
W := \frac{c_p(\text{dry air}) \cdot (T_w - T_d) + W_\text{sat} \cdot (\Delta_\text{vap}(h) + c_p(\text{sat, steam}) \cdot T_w - c_p(\text{sat, liquid water}) \cdot T_w)}{\Delta_\text{vap}(h) + c_p(\text{sat, steam}) \cdot T_d - c_p(\text{sat, liquid water}) \cdot T_w}\\
W := \frac{c_p(\text{dry air}) \cdot (T_w - T_d) + W_\text{sat} \cdot (\Delta_\text{vap}(h) + (c_p(\text{sat, steam}) - c_p(\text{sat, liquid water})) \cdot T_w)}{\Delta_\text{vap}(h) + c_p(\text{sat, steam}) \cdot T_d - c_p(\text{sat, liquid water}) \cdot T_w}
(\#eq:humidity-ratio-using-enthalpies)
\end{align}
``` 


dew point water on glass kim wilde