# Andmeanalüüs

Arvutustes kasutan rõhuna standardset atmosfääri, et tulemused oleksid võrreldavad graafikuga \@ref(fig:psychrometric-diagram).

```{r label = "data-analysis"}
method <- c(
  "Augusti psühhomeeter",
  "Assmanni psühhomeeter",
  "Pasco
ilmajaama
andmete järgi
niiskuse
karakteristikud"
)

t_d <- c(24, 24.6, 26.3)
SetUnitSystem("SI")
T_d <- GetTKelvinFromTCelsius(t_d)
RH_Pasco <- 30.8e-2
t_w_Pasco <- GetTWetBulbFromRelHum(t_d[3], RH_Pasco, p_at)
t_w <- c(16.5, 15.2, t_w_Pasco)
T_w <- GetTKelvinFromTCelsius(t_w)
p_w_H2O <- calculate_p_H2O(T_w)
gamma_w <- calculate_gamma_H2O(p_w_H2O, T_w)
p_dp <- calculate_p_a(p_w_H2O, gamma_whipple, t_d, t_w)
gamma_d <- calculate_gamma_H2O(calculate_p_H2O(T_d), T_d)
a <- calculate_a(gamma_w, t_d, t_w)
a[3] <- 7.6
p_d_H2O <- calculate_p_H2O(T_d)
RH <- calculate_RH(p_dp, p_d_H2O)
RH_according_to_instructions <- a / (gamma_d * 1e3) * 100
RH_psychrolib <- GetRelHumFromTWetBulb(t_d, t_w, p_at)

psychrometry <- data.frame(
  method,
  t_d,
  T_d,
  gamma_d,
  t_w,
  T_w,
  a,
  gamma_w,
  p_dp,
  RH,
  RH_according_to_instructions,
  RH_psychrolib
)

colnames(psychrometry) = c(
  "Meetod või sensor",
  "$\\frac{t_\\text{d}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{T_\\text{d}}{\\unit{\\kelvin}}$",
  "$\\frac{\\gamma_\\text{d}}{\\unit{\\kilogram\\per\\cubic\\meter}}$",
  "$\\frac{t_\\text{w}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{T_\\text{w}}{\\unit{\\kelvin}}$",
  "$\\frac{a}{\\unit{\\gram\\per\\cubic\\meter} - \\unit{\\degreeCelsius}}$",
  "$\\frac{\\gamma_\\text{w}}{\\unit{\\kilogram\\per\\cubic\\meter}}$",
  "$\\frac{p_\\text{dp}(\\ce{H_2O})}{\\unit{\\Pa}}$",
  "$RH$",
  "Vastavalt juhendile $\\frac{RH}{\\unit{\\percent}}$",
  "Vastavalt \"psychrolib\"ile $RH$"
)


print_table(
  psychrometry,
  caption = "Suhtelise niiskuse arvutamise sisend- ja väljundandmed, milles $w$ tähendab märga ja $d$ kuiva keskkonda ning $dp$ kastepunkti.",
  digits = 5
) %>%
  column_spec(1, width = "6em") %>%
  column_spec(11, width = "5em") %>%
  column_spec(12, width = "5em") %>%
  landscape()

librarian::shelf("psychrolib")
# psychometrics <- CalcPsychrometricsFromTWetBulb(t, t1, p_at)
# print(psychometrics)
# GetDegreeOfSaturation(t, psychometrics$HumRatio, p_at)
# print(t)
# GetDryAirVolume(t, p_at)
# GetMoistAirDensity(t, psychometrics$HumRatio, p_at)
# GetMoistAirVolume(t, psychometrics$HumRatio, p_at)
# GetSatVapPres(t)
# GetStandardAtmPressure(10)
# GetStationPressure(p_at, 10, t)
# GetVaporPressureDeficit(t, psychometrics$HumRatio, p_at)
# GetVapPresFromHumRatio(psychometrics$HumRatio, p_at)
# > 1/69.006*1000-.64*(24-16.5)
# [1] 9.691493
# > 9.691493/(1/45.863*1000)
# [1] 0.4444809
# > .5/755*1013.25
# [1] 0.6710265
# > -5.8002206e3/(24+273.15) + 1.3914993e0 - 4.8640239e-2*(24+273.15) + 4.1764768e-5*(24+273.15)^2 - 1.4452093e-8*(24+273.15)^3 + 6.5459673e0*log((24+273.15))
# [1] 8.001398
# > exp(1)^8.001398
# [1] 2985.128
# > 2985.128*.018/8.314472/(24+273.15)
# [1] 0.02174829

```

```{r label = "dp"}
t_dp_Pasco <- 6.8
T_dp_Pasco <- GetTKelvinFromTCelsius(t_dp_Pasco)
p_dp <- calculate_p_H2O(T_dp_Pasco)
p_d <- calculate_p_H2O(GetTKelvinFromTCelsius(t_d[3]))
RH <- calculate_RH(p_dp, p_d)
t_dp_r <- 5.9
T_dp_r <- GetTKelvinFromTCelsius(t_dp_r)
```

Pasco ilmajaamaga väljamõõdetud kastepunkt oli $\qty{`r t_dp_Pasco`}{\degreeCelsius}$ ehk  $\qty{`r T_dp_Pasco`}{\kelvin}$. Selle kaudu arvutatud õhuniiskus oli  `r RH`.

Katseliselt mõõtsime kastepunktiks $\qty{`r t_dp_r`}{\degreeCelsius}$ ehk  $\qty{`r T_dp_r`}{\kelvin}$.
```{r label = "own-calculations"}
W <- calculate_W(T_d, T_w)
T_dp <- calculate_Tdp(W)
```

Augusti psühhomeetriga mõõdetud temperatuuride järgi oli kastepunkt minu arvutuste kohaselt $\qty{`r T_dp[1]`}{\kelvin}$. Tabeli järgi 

Assmanni psühhomeetriga mõõdetud temperatuuride järgi oli kastepunkt minu arvutuste kohaselt $\qty{`r T_dp[2]`}{\kelvin}$.

Teen nüüd kogu andmeanalüüsi juhendi järgi kasutades ainult psühromeetreid kandes tulemused tabelisse \@ref(tab:manual).

```{r label = "manual"}
device <- c("Augusti", "Assmanni")
t_manual <- c(24, 24.6)
t_1_manual <- c(16.5, 15.2)
t_dp_MANUAL <- c(9, 6 + (7.8 - 7.4) * (7 - 6))
A_1_manual <- c(mean(13.6, 14.5), 12.8 + (16 - 15.2) * (13.6 - 12.8))
a_manual <- A_1_manual - .64 * (t_manual - t_1_manual)
A_manual <- c(22.2, 24.6 + (25 - 24.6) * (23.5 - 22.2))
R_manual <- a_manual / A_manual * 100
data_frame_manual <- data.frame(device, t_manual, t_1_manual, t_dp_MANUAL, A_1_manual, a_manual, A_manual, R_manual)

colnames(data_frame_manual) <- c(
  "Psühhomeeter",
  "$\\frac{t}{\\unit{\\degreeCelsius}}$",
  "$\\frac{t_1}{\\unit{\\degreeCelsius}}$",
  "$\\frac{t_\\text{dp}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{A_1}{\\unit{\\gram\\per\\cubic\\meter}}$",
  "$\\frac{a}{\\unit{\\gram\\per\\cubic\\meter}}$",
  "$\\frac{A}{\\unit{\\gram\\per\\cubic\\meter}}$",
  "$\\frac{R}{\\unit{\\percent}}$"
)

print_table(
  data_frame_manual,
  caption = "Suhtelise niiskuse arvutamise sisend- ja väljundandmed vastavalt juhendile, milles $1$ tähendab märga keskkonda.",
  digits = 3
)

```

<!-- # juhendi valem -->
<!-- # juhendi niiskuste tabel -->
<!-- # psychrolib -->
<!-- # meto -->
<!-- # chart -->
<!-- # r ehk minu -->

(ref:inbook) @inbook, p. 37
(ref:ashrae) @American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 14
(ref:whipple) @Whipple_1933, p. 315

Viimaks koondan tabelisse \@ref(tab:comparison-of-pressure) kolme mõõtmisvahendiga absoluutse õhuniiskuse, suhtelise õhuniiskuse ja kastepunkti 

```{r label = "comparison-of-pressure"}
DEVICES_FOR_COMPARISON <- c("Augusti psühromeeter", "Assmanni psühromeeter", "Pasco ilmajaam")
p_sat_FOR_COMPARISON <- calculate_p_H2O(T_d)
p_sat_FOR_COMPARISON_OF_inbook <- calculate_p_sat_in_inbook(T_d)
gamma_FOR_COMPARISON <- c(calculate_gamma(p_at, "natural ventilated"), calculate_gamma(p_at, "ventilated"), calculate_gamma(p_at, "non-ventilated"))
p_sat_at_T_w_FOR_COMPARISON <- calculate_p_H2O(T_w)
p_a_FOR_COMPARISON <- calculate_p_a(p_sat_at_T_w_FOR_COMPARISON, gamma_FOR_COMPARISON, T_d, T_w)
p_a_FOR_COMPARISON_OF_inbook <- calculate_p_a(calculate_p_sat_in_inbook(T_w), gamma_FOR_COMPARISON, T_d, T_w)
p_a_FOR_COMPARISON_OF_whipple <- calculate_p_a(p_sat_at_T_w_FOR_COMPARISON, calculate_gamma(p_at), T_d, T_w)
RH_FOR_COMPARISON <- calculate_RH(p_a_FOR_COMPARISON, p_sat_FOR_COMPARISON)
RH_FOR_COMPARISON_OF_inbook <- calculate_RH(p_a_FOR_COMPARISON_OF_inbook, p_sat_FOR_COMPARISON_OF_inbook)
RH_FOR_COMPARISON_OF_whipple <- calculate_RH(p_a_FOR_COMPARISON_OF_whipple, p_sat_FOR_COMPARISON)
RH_FOR_COMPARISON_OF_MANUAL <- a * 1e-3 / calculate_gamma_H2O(calculate_p_H2O(T_d), T_d)  
librarian::shelf("MeTo")
gamma_MeTo <- psyc_cons(elev = 10)
calculate_p_H2O

DATA_FRAME_OF_COMPARISON <- data.frame(
  DEVICES_FOR_COMPARISON,
  t_d,
  T_d,
  t_w,
  T_w,
  p_sat_FOR_COMPARISON,
  p_sat_FOR_COMPARISON_OF_inbook,
  gamma_FOR_COMPARISON,
  p_a_FOR_COMPARISON,
  p_a_FOR_COMPARISON_OF_inbook,
  p_a_FOR_COMPARISON_OF_whipple,
  RH_FOR_COMPARISON,
  RH_FOR_COMPARISON_OF_inbook,
  RH_FOR_COMPARISON_OF_whipple,
  RH_FOR_COMPARISON_OF_MANUAL
)

DATA_FRAME_OF_COMPARISON_TRANSPOSED <- t(DATA_FRAME_OF_COMPARISON)

print(DATA_FRAME_OF_COMPARISON_TRANSPOSED)

footnote_1 <- footnote_marker_number(1)
footnote_2 <- footnote_marker_number(2)
footnote_1_3 <- paste(footnote_1, footnote_marker_number(3))

rownames(DATA_FRAME_OF_COMPARISON_TRANSPOSED) <- c(
  "Seade",
  "$\\frac{t_\\text{d}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{T_\\text{d}}{\\unit{\\kelvin}}$",
  "$\\frac{t_\\text{w}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{T_\\text{w}}{\\unit{\\kelvin}}$",
  paste("$\\frac{p_\\text{sat}}{\\unit{\\pascal}}$", footnote_1),
  paste("$\\frac{p_\\text{sat}}{\\unit{\\pascal}}$", footnote_2),
  "$\\frac{\\gamma}{\\unit{\\pascal\\per\\kelvin}}$",
  paste("$\\frac{p_\\text{a}}{\\unit{\\pascal}}$", footnote_1),
  paste("$\\frac{p_\\text{a}}{\\unit{\\pascal}}$", footnote_2),
  paste("$\\frac{p_\\text{a}}{\\unit{\\pascal}}$", footnote_1_3),
  paste("$RH$", footnote_1),
  paste("$RH$", footnote_2),
  paste("$RH$", footnote_1_3),
  paste("$RH$", footnote_marker_number(4))
)

colnames(DATA_FRAME_OF_COMPARISON) <- c(
  "Seade",
  "$\\frac{t_\\text{d}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{T_\\text{d}}{\\unit{\\kelvin}}$",
  "$\\frac{t_\\text{w}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{T_\\text{w}}{\\unit{\\kelvin}}$",
  paste("$\\frac{p_\\text{sat}}{\\unit{\\pascal}}$", footnote_1),
  paste("$\\frac{p_\\text{sat}}{\\unit{\\pascal}}$", footnote_2),
  "$\\frac{\\gamma}{\\unit{\\pascal\\per\\kelvin}}$",
  paste("$\\frac{p_\\text{a}}{\\unit{\\pascal}}$", footnote_1),
  paste("$\\frac{p_\\text{a}}{\\unit{\\pascal}}$", footnote_2),
  paste("$\\frac{p_\\text{a}}{\\unit{\\pascal}}$", footnote_1_3),
  paste("$RH$", footnote_1),
  paste("$RH$", footnote_2),
  paste("$RH$", footnote_1_3)
)

print_table(
  DATA_FRAME_OF_COMPARISON_TRANSPOSED,
  caption = "Psühhomeetrilised võrdlusandmed.",
  digits = 3
) %>%
  footnote(number = c("(ref:ashrae)", "(ref:inbook)", "(ref:whipple)", "juhend"))

# a_FOR_COMPARISON <- 
```

[@a2022_cranmeto]

```{r}
A_1 <- 13.6+(17-16)/2*(14.5-13.6)
A_1
a <- A_1-.64*(24-16.5)
a
A <- 22.2
RH <- A_1 / A
RH
RH <- a / A
RH
```


Tabelis on esitatud erinevused minu arvutuste

```{r}
t_d <- c(24, 24.6)
library("psychrolib")
SetUnitSystem("SI")
T_d <- GetTKelvinFromTCelsius(t_d)
t_w <- c(16.5, 15.2)
T_w <- GetTKelvinFromTCelsius(t_w)
GetTDewPointFromTWetBulb(t_d, t_w, 101325)
1.013e-3/(.622 * 2.45)
1.006/(.622 * 2500.9)
.5/755
.46/(1+(1-.46)*0.01174108/.622)
#e_0_T_w <- .611 * exp(17.27 * T_w / T_w + 237.3)
#(112 + .9 * T_w) * (e_a / e_0_T_w)^(1 / 8) - 112 + .1 * T_w
```

```{r}
t_d <- 24#30
t_w <- 16.5#20
T_d <- GetTKelvinFromTCelsius(t_d)
T_w <- GetTKelvinFromTCelsius(t_w)
T_w
RHS <- -5.8002206e3 * T_w^-1 + 1.3914993 * T_w^0 - 4.8640239e-2 * T_w^1 + 4.1764768e-5 * T_w^2 - 1.4452093e-8 * T_w^3 + 6.5459673 *   log(T_w)
RHS
p_ws <- exp(RHS)
p_ws
W_sat <- .6219495 * p_ws / (101325 - p_ws)
W_sat
W <- (1.006 * (T_w - T_d) + W_sat * (2501 - 2.381 * t_w)) / (2501 + 1.805 * t_d - 4.186 * t_w)
W

p_w <- 101325 * W / (0.621945 + W)
p_w
alpha <- log(p_w*1e-3)
T_dp <- 6.54 + 14.526 * alpha + .7389 * alpha^2 + .09486 * alpha^3 + .4569 * (p_w*1e-3)^.1984+273.15
T_dp
```
```{r}
psyc_cons(elev = 2)

```


6-1 vesi6-17 õhu cp