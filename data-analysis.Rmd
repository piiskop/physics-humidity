# Andmeanalüüs

Arvutustes kasutan rõhuna standardset atmosfääri, et tulemused oleksid võrreldavad graafikuga \@ref(fig:psychrometric-diagram).

```{r label = "data-analysis"}
method <- c(
  "Augusti psühhomeeter",
  "Assmanni psühhomeeter",
  "Pasco
ilmajaama
andmete järgi
niiskuse
karakteristikud"
)

t_d <- c(24, 24.6, 26.3)
SetUnitSystem("SI")
T_d <- GetTKelvinFromTCelsius(t_d)
RH_Pasco <- 30.8e-2
t_w_Pasco <- GetTWetBulbFromRelHum(t_d[3], RH_Pasco, p_at)
t_w <- c(16.5, 15.2, t_w_Pasco)
T_w <- GetTKelvinFromTCelsius(t_w)
p_w_H2O <- calculate_p_H2O(T_w)
gamma_w <- calculate_gamma_H2O(p_w_H2O, T_w)
p_dp <- calculate_p_dp(p_w_H2O, t_d, t_w)
gamma_d <- calculate_gamma_H2O(calculate_p_H2O(T_d), T_d)
a <- gamma_w * 1e3 - .64 * (t_d - t_w)
p_d_H2O <- calculate_p_H2O(T_d)
RH <- calculate_RH(p_dp, p_d_H2O)
RH_according_to_instructions <- a / (gamma_d * 1e3) * 100
RH_psychrolib <- GetRelHumFromTWetBulb(t_d, t_w, p_at)

psychrometry <- data.frame(
  method,
  t_d,
  T_d,
  gamma_d,
  t_w,
  T_w,
  a,
  gamma_w,
  p_dp,
  RH,
  RH_according_to_instructions,
  RH_psychrolib
)

colnames(psychrometry) = c(
  "Meetod või sensor",
  "$\\frac{t_\\text{d}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{T_\\text{d}}{\\unit{\\kelvin}}$",
  "$\\frac{\\gamma_\\text{d}}{\\unit{\\kilogram\\per\\cubic\\meter}}$",
  "$\\frac{t_\\text{w}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{T_\\text{w}}{\\unit{\\kelvin}}$",
  "$\\frac{a}{\\unit{\\gram\\per\\cubic\\meter} - \\unit{\\degreeCelsius}}$",
  "$\\frac{\\gamma_\\text{w}}{\\unit{\\kilogram\\per\\cubic\\meter}}$",
  "$\\frac{p_\\text{dp}(\\ce{H_2O})}{\\unit{\\Pa}}$",
  "$RH$",
  "Vastavalt juhendile $\\frac{RH}{\\unit{\\percent}}$",
  "Vastavalt \"psychrolib\"ile $RH$"
)


print_table(
  psychrometry,
  caption = "Suhtelise niiskuse arvutamise sisend- ja väljundandmed, milles $w$ tähendab märga ja $d$ kuiva keskkonda ning $dp$ kastepunkti.",
  digits = 5
) %>%
  column_spec(1, width = "6em") %>%
  column_spec(11, width = "5em") %>%
  column_spec(12, width = "5em") %>%
  landscape()

librarian::shelf("psychrolib")
# psychometrics <- CalcPsychrometricsFromTWetBulb(t, t1, p_at)
# print(psychometrics)
# GetDegreeOfSaturation(t, psychometrics$HumRatio, p_at)
GetDryAirVolume(t, p_at)
# GetMoistAirDensity(t, psychometrics$HumRatio, p_at)
# GetMoistAirVolume(t, psychometrics$HumRatio, p_at)
GetSatVapPres(t)
GetStandardAtmPressure(10)
GetStationPressure(p_at, 10, t)
# GetVaporPressureDeficit(t, psychometrics$HumRatio, p_at)
# GetVapPresFromHumRatio(psychometrics$HumRatio, p_at)
# > 1/69.006*1000-.64*(24-16.5)
# [1] 9.691493
# > 9.691493/(1/45.863*1000)
# [1] 0.4444809
# > .5/755*1013.25
# [1] 0.6710265
librarian::shelf("MeTo")
psyc_cons(elev = 2, P = 101.3)
# > -5.8002206e3/(24+273.15) + 1.3914993e0 - 4.8640239e-2*(24+273.15) + 4.1764768e-5*(24+273.15)^2 - 1.4452093e-8*(24+273.15)^3 + 6.5459673e0*log((24+273.15))
# [1] 8.001398
# > exp(1)^8.001398
# [1] 2985.128
# > 2985.128*.018/8.314472/(24+273.15)
# [1] 0.02174829

```

```{r label = "dp"}
t_dp_Pasco <- 6.8
T_dp_Pasco <- GetTKelvinFromTCelsius(t_dp_Pasco)
p_dp <- calculate_p_H2O(T_dp_Pasco)
p_d <- calculate_p_H2O(GetTKelvinFromTCelsius(t_d[3]))
RH <- calculate_RH(p_dp, p_d)
t_dp_r <- 5.9
T_dp_r <- GetTKelvinFromTCelsius(t_dp_r)
```

Pasco ilmajaamaga väljamõõdetud kastepunkt oli $\qty{`r t_dp_Pasco`}{\degreeCelsius}$ ehk  $\qty{`r T_dp_Pasco`}{\kelvin}$. Selle kaudu arvutatud õhuniiskus oli  `r RH`.

Katseliselt mõõtsime kastepunktiks $\qty{`r t_dp_r`}{\degreeCelsius}$ ehk  $\qty{`r T_dp_r`}{\kelvin}$.
```{r}
W <- calculate_W(T_d, T_w)
T_dp <- calculate_Tdp(W)
print(T_dp)
```


```{r}
t_d <- c(24, 24.6)
library("psychrolib")
SetUnitSystem("SI")
T_d <- GetTKelvinFromTCelsius(t_d)
t_w <- c(16.5, 15.2)
T_w <- GetTKelvinFromTCelsius(t_w)
GetTDewPointFromTWetBulb(t_d, t_w, 101325)
```

```{r}
t_d <- 30
t_w <- 20
T_d <- GetTKelvinFromTCelsius(t_d)
T_w <- GetTKelvinFromTCelsius(t_w)
T_w
RHS <- -5.8002206e3 * T_w^-1 + 1.3914993 * T_w^0 - 4.8640239e-2 * T_w^1 + 4.1764768e-5 * T_w^2 - 1.4452093e-8 * T_w^3 + 6.5459673 *   log(T_w)
RHS
p_ws <- exp(RHS)
p_ws
W_sat <- .6219495 * p_ws / (101325 - p_ws)
W_sat
W <- (1.006 * (T_w - T_d) + W_sat * (2501 - 2.381 * t_w)) / (2501 + 1.805 * t_d - 4.186 * t_w)
W

p_w <- 1.69#1908.004e-3
alpha <- log(p_w)
T_dp <- 6.54 + 14.526 * alpha + .7389 * alpha^2 + .09486 * alpha^3 + .4569 * p_w^.1984
T_dp
```


6-1 vesi6-17 õhu cp