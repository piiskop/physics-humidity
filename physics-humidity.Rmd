--- 
title: "Õhuniiskuse karakteristikute määramine"
subtitle: "Viies laboratoorne töö soojusõpetuses"
author: "peacecop kalmer:"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: article
papersize: a4
fontsize: 12pt
mainfont: Times New Roman
classoption: onecolumn, twoside
sep: ", "
geometry:  left=3cm, right=2cm, top=2cm, bottom=3cm
linestretch: 1.5
lof: yes
lot: yes
bibliography: [book.bib]
# url: your book url like https://bookdown.org/yihui/bookdown
# cover-image: path to the social sharing image like images/cover.jpg
description: |
  This is a minimal example of using the bookdown package to write a book.
  The HTML output format for this example is bookdown::bs4_book,
  set in the _output.yml file.
biblio-style: apalike
link-citations: yes
# csl: chicago-fullnote-bibliography.csl
graphics: yes
lang: et

---

```{r setup, echo=FALSE, message=FALSE}
# example R options set globally
options(bookdown.render.file_scope = FALSE)

# example chunk options set globally
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  echo = TRUE,
  out.width = "\\textwidth",
  out.height = "\\textheight",
  out.extra = "keepaspectratio=true",
  fig.margin = TRUE,
  attr.source = '.numberLines'
)

if (!require("librarian")) {
  install.packages("librarian", dependencies = TRUE)
}

library(librarian)

include_svg = function(path) {

  if (knitr::is_latex_output() && ("pdf" != xfun::file_ext(path))) {
    output = xfun::with_ext(path, 'pdf')
    # you can compare the timestamp of pdf against svg to avoid conversion if necessary
    
    if ("svg" == xfun::file_ext(path)) {
      system2('rsvg-convert', c('-f', 'pdf', '-a', '-o', shQuote(c(output, path))))

      # librarian::shelf(
      #   "magick"
      # )
      # 
      # img <- image_read(path)
      # image_write(img, path = output, format = "pdf")
      # system2("dwebp", c(shQuote(c(path)), "-o", shQuote(c(output, path))))
    # system2('rsvg-convert', c('-f', 'pdf', '-a', '-o', shQuote(c(output, path))))
    } else {
      system(paste('gm convert ', path, ' ', output), intern = FALSE, ignore.stdout = FALSE, ignore.stderr = FALSE, wait = TRUE)
    }
    
  } else {
    output = path
  }
  
  knitr::include_graphics(output)
}

if (!require("librarian")) {
  install.packages("librarian", dependencies = TRUE)
}

library(librarian)

print_table <- function(data_frame, caption, digits = 2, additional_header = "") {

  if (!is.null(knitr::opts_knit$get('rmarkdown.pandoc.to')) && (knitr::opts_knit$get('rmarkdown.pandoc.to') == "docx")) {
    librarian::shelf("flextable")
    table <- (flextable(data_frame))
  } else {
    librarian::shelf("kableExtra")

    table <- kable(data_frame, booktabs = TRUE, escape = FALSE, caption = caption, digits = digits, longtable = TRUE)
    
    if (is.data.frame(additional_header) || is.vector(additional_header)) {
      table <- add_header_above(kable_input = table, header = additional_header, escape = FALSE)
    }
    
    
    table <- (kable_styling(
      table,
      bootstrap_options = c("striped", "bordered", "condensed", "responsive", "hover"),
      latex_options = c("striped", "repeat_header"),
      repeat_header_text = paste(caption, "$\\textit{(Jätkub...)}$"),
      repeat_header_method = "replace",
      repeat_header_continued = "Tabel järgneb järgmisel leheküljel..."
    ))
    
  } 

  return(table)
}

```

```{=tex}
\sisetup{inter-unit-product = \ensuremath { { } \times { } } }
```

<!--chapter:end:index.Rmd-->

# Eesmärgid

1. Õhuniiskuse peamiste karakteristikute ja vahenditega nende määramiseks tutvutud.

2. Õhu relatiivne ja absoluutne niiskus ning kastepunkt erinevate meetoditega katseliselt määratud.

<!--chapter:end:goals.Rmd-->

# Vahendid

1. anspiratsioonpsühhopeeter,

2. statsionaarne pühhomeeter,

3. läikiva välispinnag ametallist õõneskera statiivil,

4. temperatuurisensor,

5. jäätükid,

6. puhas riidelapp,

7. aknapuhastuse vahend,

8. destilleeritud vesi,

9. limasensor,

10. mitmeotstarbeline arvuti.

<!--chapter:end:tools.Rmd-->

# Reeglid

## Jõud

```{=tex}
\begin{align}
\vec{F} := m \cdot \vec{a},
(\#eq:force)
\end{align}
```

kus *m* on mass ja *a* on kiirendus [@haynes_2014_crc, p. 2-2]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{M \cdot \frac{L}{T^2} = \frac{L \cdot M}{T^2}},
(\#eq:dimensional-analysis-for-force)
\end{align}
```

mistõttu ühik on $\unit{\meter\kilogram\per\second\squared}$ või lühemalt $\unit{\newton}$.

## Temperatuur


```{=tex}
\begin{align}
T := t + 237.15,
(\#eq:absolute-temperature)
\end{align}
```

mille ühik on $\unit{\kelvin}$ [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 8].

## Energia, töö, soojushulk


```{=tex}
\begin{align}
E := \int{\vec{F}} \cdot \mathrm{d}(s) = \int{m \cdot \vec{a}} \cdot \mathrm{d}(s),
(\#eq:energy)
\end{align}
```

milles $\mathrm{d}(s)$ on lõputult väike nihe [@haynes_2014_crc, p. 2-2]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{L \cdot M}{T^2} \cdot L = \frac{L^2 \cdot M}{T^2}},
(\#eq:dimensional-analysis-for-energy)
\end{align}
```

mistõttu ühik on $\unit{\frac{m^2 \cdot kg}{s^2}}$ või lühemalt $\unit{m \cdot N}$ või veelgi lühemalt $\unit{J}$.

## Rõhk

```{=tex}
\begin{align}
p := \frac{F}{A} = \frac{m \cdot a}{A},
(\#eq:pressure)
\end{align}
```

kus *A* on pindala [@haynes_2014_crc, p. 2-2]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{L \cdot M}{T^2 \cdot L^2} = \frac{M}{T^2 \cdot L}},
(\#eq:dimensional-analysis-for-pressure)
\end{align}
```

mistõttu ühik on $\unit{\kilogram\per\second\squared\per\meter}$ või lühemalt $\unit{\pascal}$.


```{r label = "pressure"}
p <- 100e3
p_at <- 101.325e3
```

standardseisund
: määratletud olek (määratud temperatuur, rõhk, kontsentratsioon jne) termodünaamiliste funktsioonide tabeleerimiseks ja termodünaamiliste arvutuste tegemiseks [@haynes_2014_crc, p. 2-65]

Standardseisundi rõhk on `r p` $\unit{\pascal}$ [@haynes_2014_crc, p. 1-7]. Standardne atmosfäär on `r p_at` $\unit{\pascal}$.

Ideaalse gaasi rõhk:
```{r label = "r"}
R <- 8314.472e-3
```

```{=tex}
\begin{align}
p := \frac{n \cdot R \cdot T}{V},
(\#eq:pressure-of-ideal-gas)
\end{align}
```

milles *n* on ainehulk, *R* on universaalne gaasikonstant $`r R` \times \unit{\joule\per\mole\per\kelvin}$ ja *V* on ruumala [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 14]. Dimensionaalanalüüs:


```{=tex}
\begin{align}
\frac{\mathrm{N} \cdot \frac{\mathrm{L^2 \cdot M}}{\mathrm{T^2 \cdot N} \cdot \Theta} \cdot \Theta}{\mathrm{L^3}} = \mathrm{\frac{M}{L \cdot T^2}},
(\#eq:dimensional-analysis-for-pressure-of-ideal-gas)
\end{align}
```

mistõttu ühik on $\unit{\kilogram\per\meter\per\second\squared}$ ehk lühemalt $\unit{\pascal}$.

Küllastusrõhk vedela vee kohal temperatuurivahemikus 0 kuni 200°C on antud valemiga

```{=tex}

\begin{align}
& p_{ws} && := e^{\sum_{i := 8}^{n}{C_i \times T^{i - 9}} + 6.5459673 \times \mathrm{ln}(T)}\\
&&&= e^{\sum_{i := 8}^n{C_i \times (t + 273.15)^{i - 9}} + 6.5459673 \times \mathrm{ln}(t + 273.15)}\text{, kus}\\
& C_8 && := -5.8002206 \times 10^3,\\
& C_9 && := 1.3914993,\\
& C_{10} && := -4.8640239 \times 10^{-2},\\
& C_{11} && := 4.1764768 \times 10^{-5},\\
& C_{12} && := -1.4452093 \times 10^{-8}
(\#eq:saturation-pressure-over-liquid-h2o)
\end{align}

```

milles *T* on absoluutne temperatuur [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 14].

## Molaarmass

molaarmass
: aine ühe mooli mass [@haynes_2014_crc, p. 2-60]

```{=tex}
\begin{align}
M_\mathrm{B} := \frac{m}{n_\mathrm{B}},
(\#eq:molar-mass)
\end{align}
```

kus $n_\mathrm{B}$ on (aine)hulk [@haynes_2014_crc, p. 2-8]. Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{M}{N}},
(\#eq:dimensional-analysis-for-molar-mass)
\end{align}
```

mistõttu ühik on $\unit{\kilogram\per\mole}$.
```{r label = "molar-masses"}
M_H <- (1.00782503512 * 99.9851e-2 + 2.01410177924 * 0.0151e-2) * 1e-3
M_He <- (3.016029314 * 0.0001373e-2 + 4.00260325 * 99.9998633e-2) * 1e-3
M_C <- (12 * 98.903 + 13.00335482617 + 1.103e-2) * 1e-3
M_N <- (14.00307400226 * 99.635e-2 + 15.000108974 * 0.367e-2) * 1e-3
M_O <- (15.994914636 * 99.76215e-2 + 16.99913124 * 0.0383e-2 + 17.9991604 * 0.20012e-2) * 1e-3
M_Ne <- (19.992435622 * 90.483e-2 + 20.993842821 * 0.271e-2 + 21.991383118 * 9.253e-2) * 1e-3
M_Ar <- (35.9675455229 * 0.3373e-2 + 37.9627326 * 0.0631e-2 + 39.962383714 * 99.6003e-2) * 1e-3
M_Kr <- (77.920397 * 0.352e-2 + 79.916381 * 2.252e-2 + 81.913483 * 11.61e-2 + 82.9141354 * 11.51e-2 + 83.9115074 * 57.03e-2 + 85.910617 * 17.32e-2) * 1e-3
M_Xe <- (123.90589422 * 0.101e-2 + 125.904282 * 0.091 + 127.9035312172 * 1.913 + 128.904780121 * 26.5e-2 + 129.9035094172 * 4.11e-2 + 130.905073 * 21.243e-2 + 131.904145 * 27e-2 + 133.905396 * 10.42e-2 + 135.907215 * 8.91e-2) * 1e-3

M_H2O <- M_H * 2 + M_O
M_H2O_haynes <- 18.015268e-3
M_air <- 28.966e-3

```

Vee molaarmass on vastavalt [@haynes_2014_crc, p. 6-9] $`r M_H2O_haynes` \times \unit{\kilogram\per\mole}$ ning minu arvutustele $`r M_H2O` \times \unit{\kilogram\per\mole}$. Kuna enda äralöök on kindlam kui loodetav vastase aut, siis kasutan edaspidi arvutustes enda arvutusi, kui pole sätestatud teisiti.

Õhu molaarmassi saaks ka otse teatmikust võtta, aga tahan ikkagi näidata, millest see on kokku arvutatud. Õhk koosneb mitmest komponendist, millest kõik peale süsihappegaasi ja hapniku on piisavalt püsiva osalusega. Süsihappegaasi sisaldus õhus varieerub pidevalt. Mida rohkem on õhus süsihappegaasi, seda vähem on kuivas õhus hapnikku ja vastupidi, sest põlemises liidab süsinik endaga dihapniku õhust. Õhu molaarmass muutub seega sõltuvalt sellest, kui palju süsinikku kas õhku lisandub või sellest eraldub. Praegu elame perioodis, milles süsinikku kuiva õhku lisandub. Õhu koostist, muuhulgas süsinikdioksiidi sisaldust mõõdetakse iga tund. Leidsin Barrow Atmospheric Baseline Observatory' andmed, mis on kogutud $\qty{27.46}{\meters}$ kõrguselt, mis on umbes see kõrgus, kus me oma eksperimente tegime ja mis on kõige kaasaegsemad [@NOAA_GML_CCGG_Group2019-oq]. Kuigi [@RN23688432420080101, p. 1] mainitakse, et praktiline oleks kasutada selliste andmete põhjal tehtud projektsioonväärtust, samas kurdetakse, et aktuaalset väärtust on keeruline leida [@RN23688432420080101, p. 3], soovin mina kasutada viimati väljamõõdetud väärtust, sest sellest pole liiga palju aega möödunud. Viimatised andmed on nimelt pärit 2021. aasta viimase kuu esimesest päevast, millest praeguse aruande kirjutamiseni on möödas veidi üle poole aasta. Loodan põhistada oma soovi sellega, et need andmed pole normaalselt jaotunud, mistõttu ei saa usaldusväärset regressiooni nende põhjal teostada, et ekstrapoleerida tänast väärtust.

```{r}
CO2_in_air <- read.table("co2_brw_surface-insitu_1_ccgg_HourlyData.txt", header = TRUE, sep = "", dec = ".")

librarian::shelf(
  ggplot2,
  latex2exp,
  ggpubr # for stat_regline_equation
)

CO2_in_air <- subset(CO2_in_air, value > -999.99)
hist(CO2_in_air$value)
ggplot(data = CO2_in_air, aes(x = time_decimal, y = value)) + geom_point() +
  labs(x = TeX("$\\frac{\\Delta(t)}{s}$"), y = TeX("$\\frac{\\frac{E}{\\Delta(m)}}{\\frac{J}{kg}}$")) +
  geom_smooth(formula = "y ~ x", method = "lm", se = FALSE) +
  stat_regline_equation()
-3200+1.8*2022.5
income.happiness.lm <- lm(value ~ time_decimal, data = CO2_in_air)

summary(income.happiness.lm)
par(mfrow=c(2,2))
plot(income.happiness.lm)
par(mfrow=c(1,1))
ks.test(CO2_in_air$value,"pnorm")

```


Õhu molaarmassi võib võtta teatmikust, aga võib ka õhu koostisosade molaarmasside põhjal ise arvutada, et näha, millest õhu molaarmass koosneb. [@haynes_2014_crc, p. 6-164] põhjal esinevad lämmastik, hapnik ja vesinik kaksikaatomist koosneva lihtainena. Õhu koostis on üldiselt püsiv, kuid seda mõjutab süsihappe gaasi poolt hapniku asendamine. Viimast 

Todo:
süsihappe gaasi trend
tglt kasutada viimast väärtust
arvutada õh umolaarmass

```{r label = "consistence-of-air"}
SUBSTANCE <- c(
  "$\\ce{N_2}$",
  "$\\ce{O_2}$",
  "$\\ce{Ar}$",
  "$\\ce{CO_2}$",
  "$\\ce{Ne}$",
  
  "$\\ce{He}$",
  "$\\ce{Kr}$",
  "$\\ce{Xe}$",
  "$\\ce{CH_4}$",
  "$\\ce{H_2}$",
  
  "$\\ce{N_2O}$",
  "$\\ce{CO}$"
)

# DELTA_CO2 <- 2036 - 2005format(Sys.Date(), "%Y") - 2005
# PART <- c(
#   780818,
#   209435,
#   9332,
#   385*,
#   18.2,
# 
#   5.2,
#   1.1,
#   .1,
#   1.5,
#   .5,
# 
#   .3,
#   .2
# )

```
```{r}
```
We found a significant relationship between income and happiness (p < 0.001, R2 = 0.73 ± 0.0193), with a 0.73-unit increase in reported happiness for every $10,000 increase in income.

Kuiva õhu molaarmass on vastavalt [@haynes_2014_crc, p. 6-164]

$$\mathrm{28.9655 \times \frac{\cancel{g}}{mol} \times \frac{10^{-3} \times kg}{1 \times \cancel{g}} = 2.89655 \times 10^{-2} \times \frac{kg}{mol}},$$

vastavalt  [@haynes_2014_crc, p. 14-21]

$$\mathrm{28.964 \times \frac{\cancel{g}}{mol} \times \frac{10^{-3} \times kg}{1 \times \cancel{g}} = 2.8964 \times 10^{-2} \times \frac{kg}{mol}}$$
ja vastavalt  [@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 7]

$$\mathrm{28.966 \times \frac{\cancel{g}}{mol} \times \frac{10^{-3} \times kg}{1 \times \cancel{g}} = 2.8966 \times 10^{-2} \times \frac{kg}{mol}}.$$

## Massikontsentratsioon (massi tihedus)


```{=tex}
\begin{align}
γ_\mathrm{B} := \frac{m_\mathrm{B}}{V}
(\#eq:mass-concentration)
\end{align}
```

[@haynes_2014_crc, p. 2-8].

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{M}{L^3}},
(\#eq:dimensional-analysis-for-mass-concentration)
\end{align}
```

millest johtuvalt on ühik $\unit{\kilogram\per\cubic\metre}$.

Ideaalse gaasi tiheduse valemi loomiseks asendan ideaalse gaasi rõhu valemisse \@ref(eq:pressure-of-ideal-gas) leheküljel $\pageref{eq:pressure-of-ideal-gas}$ molaarmassi valemist \@ref(eq:molar-mass) leheküjel $\pageref{eq:molar-mass}$ ainehulga:


```{=tex}
\begin{align}
p :&= \frac{\frac{m}{M_\mathrm{B}} \cdot R \cdot T}{V}\\
p :&= \frac{m \cdot R \cdot T}{M_\mathrm{B} \cdot V}\\
\frac{m}{V} &= \frac{p \cdot M_\mathrm{B}}{R \cdot T} =: \gamma_\mathrm{B}.
(\#eq:mass-concentration-of-ideal-gas)
\end{align}
```

Dimensionaalanalüüs:


```{=tex}
\begin{align}
\mathrm{\frac{M}{L^3}} = \frac{\mathrm{\frac{M}{T^2 \cdot L} \cdot \frac{M}{N}}}{\frac{\mathrm{\frac{L^2 \cdot M}{T^2}}}{\mathrm{N} \cdot \Theta} \cdot \Theta} = \frac{\mathrm{M^2 \cdot N} \cdot \Theta}{\mathrm{T^2 \cdot L \cdot N \cdot \frac{L^2 \cdot M}{T^2}} \cdot \Theta},
(\#eq:dimensional-analysis-for-mass-concentration-of-ideal-gas)
\end{align}
```

mistõttu ühik on $\unit{\kilogram\per\cubic\meter}$.

Küllastava veeauru tiheduse arvutamiseks pistan rõhu küllastusrõhu valemist \@ref(eq:saturation-pressure-over-liquid-h2o) ideaalse gaasi tiheduse valemisse:

```{=tex}
\begin{align}
\gamma_\mathrm{B} &= \frac{e^{\sum_{i := 8}^n{C_i \times (t + 273.15)^{i - 9}} + 6.5459673 \times \mathrm{ln}(t + 273.15)} \cdot M_\mathrm{B}}{R \cdot T}.
(\#eq:density-of-saturated-h2o)
\end{align}
```
```{r label = "mass-concentration-t"}

librarian::shelf("psychrolib")

T_min <- GetTKelvinFromTCelsius(0)
T_max <- GetTKelvinFromTCelsius(200)
```

Lasen koostada tabeli \@ref(tab:density-of-saturated-h2o) küllastava veeauru tiheduse kohta vastavalt temperatuurile vahemikus $`r T_min` \times \unit{\kelvin}$ kuni $`r T_max` \times \unit{\kelvin}$:
```{r label = "density-of-saturated-h2o"}
t <- c(seq(0, 14, 2), seq(15, 27.9, .1), seq(28, 200, 4))
T <- GetTKelvinFromTCelsius(t)

calculate_p_H2O <- function(T) {
  
  for (index in 1:length(T)) {
  
    if (T[index] < 273.15 | T[index] > 473.15) {
      stop(paste("The absolute temperature must be between 273.15 and 473.15 K inclusive. The current absolute temperature at the position", index, "is", T[index], "K."))
    }
    
  }
  
  return(exp(-5.8002206e3 / T + 1.3914993 - 4.8640239e-2 * T + 4.1764768e-5 * T^2 - 1.4452093e-8 * T^3 + 6.5459673 * log(T)))
}

p_H2O <- calculate_p_H2O(T)

calculate_gamma_H2O <- function(p_H2O, T) {
  return(p_H2O * M_H2O / (R * T))
}

gamma_H2O <- calculate_gamma_H2O(calculate_p_H2O(T), T)

density_of_saturated_H2O <- data.frame(
  t,
  T,
  p_H2O,
  gamma_H2O
)

colnames(density_of_saturated_H2O) <- c(
  "$\\frac{\\text{Temperatuur}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{\\text{Absoluutne temperatuur}}{\\unit{\\kelvin}}$",
  "$\\frac{\\text{Rõhk}}{\\unit{\\pascal}}$",
  "$\\frac{\\text{Küllastava veeauru tihedus}}{\\unit{\\kilogram\\per\\cubic\\meter}}$"
)

print_table(density_of_saturated_H2O, caption = paste("Küllastava veeauru tihedused vahemikus", T_min, "$\\times \\unit{\\kelvin}$ kuni",  T_max, "$\\times \\unit{\\kelvin}$."), digits = 5)


```

Näeme jooniselt \@ref(fig:diagram-for-density-of-saturated-h2o), kuidas temperatuuri suurenedes eksponentsiaalselt suureneb küllastava veeauru tihedus. See tähendab, et mida soojem on õhk, seda rohkem veeauru õhku mahub. Inimesele sobivates tingimustes õhutemperatuuri puhul on küllastava veeauru tiheduse erinevus eri temperatuuridel peaaegu mittemärgatav ja nullilähedane.

```{r label = "diagram-for-density-of-saturated-h2o", fig.cap="Küllastava veeauru tiheduse sõltuvus temperatuurist."}
librarian::shelf(
  ggplot2,
  latex2exp
)

ggplot(data = density_of_saturated_H2O, aes(x = T, y = gamma_H2O)) +
  geom_point() +
  labs(x = TeX("$\\frac{T}{K}$"), y = TeX("$\\frac{\\gamma(H_2O)}{\\frac{kg}{m^3}}$"))

```

Näeme jooniselt \@ref(fig:diagram-for-pressure-of-saturated-h2o), kuidas temperatuuri suurenedes eksponentsiaalselt suureneb küllastava veeauru rõhk.


```{r label = "diagram-for-pressure-of-saturated-h2o", fig.cap="Küllastava veeauru rõhu sõltuvus temperatuurist."}
librarian::shelf(
  ggplot2,
  latex2exp
)

ggplot(data = density_of_saturated_H2O, aes(x = T, y = p_H2O)) +
  geom_point() +
  labs(x = TeX("$\\frac{T}{K}$"), y = TeX("$\\frac{p(H_2O)}{Pa}$"))

```

## Niiskus

niiskus
: õhus oleva vee massi suhe kuiva õhu massi [@a2018_determination]

kuivkolvi temperatuur
:  puhkeolekus mõõdetud niiskuse temperatuur, mida õhu niiskusesisaldus ega kiirgus ei mõjuta[@a2018_determination]

märgkolbi temperatuur
: dünaamiline tasakaalutemperatuur, mille veepind saavutab adiabaatilistes tingimustes õhuga kokkupuutel[@a2018_determination]

Absoluutne niiskus ehk rõhk kastepunktis:
```{r label = "rules-b"}
B <- .5 / 755
```

```{=tex}
\begin{align}
p_\text{dp} := p_\text{w} - (T_\text{d} - T_\text{w}) \cdot p \cdot B,
(\#eq:absolute-humidity)
\end{align}
```

milles *dp* tähendab kastepunkti, *w* märga ja *d* kuiva ning $B := `r B` \times \unit{\\per\\kelvin}$ [@Whipple_1933]. See absoluutse niiskuse arvutamise valem kehtib vedela vee kohta.

suhteline niiskus
: õhus oleva veeauru osarõhu ja vee küllastusauru rõhu suhe samal 
temperatuuril, väljendatud protsentides [@haynes_2014_crc, p. 2-63]

Suhtelise niiskuse valem:

```{=tex}
\begin{align}
RH := \frac{p_\text{dp}}{p_\text{d}}
(\#eq:relative-humidity)
\end{align}
```

[@American_Society_of_Heating_Refrigerating_and_Air-Conditioning_Engineers2017-im, p. 15].

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\mathrm{\frac{\frac{M}{L^3}}{\frac{M}{L^3}}} = 1.
(\#eq:dimensional-analysis-for-relative-humidity)
\end{align}
```

Tabelis \@ref(tab:rh) on esitatud väljaarvutatud suhteline niiskus valitud temperatuuride korral, mida saab võrrelda [@haynes_2014_crc, p. 15-32] tabeliga.

```{r label = "rh"}
calculate_RH <- function(p_dp, p_d_H2O) {
  return(p_dp / p_d_H2O)
}

calculate_p_dp <- function(p_w_H2O, T_d, T_w) {
  return(p_w_H2O - (T_d - T_w) * p_at / 1510)
}

t_d <- c(seq(10, 24, 1), seq(24.1, 27, .1), seq(28, 31, 1), seq(32, 48, 2), 49, seq(50, 200, 50))
T_d <- GetTKelvinFromTCelsius(t_d)
delta_T <- c(seq(1, 7, 1), seq(7.5, 9, .5), 9.4, 9.5, 10, 10.5, 10.8, 11, 12, 15)

calculate_RH_from_delta_T <- function(T_d, delta_T) {
  RH <- c()
  
  for (index in 1:length(T_d)) {
    T_w <- T_d[index] - delta_T
    
    if (T_w < 273.15) {
      RH <- c(RH, "")
    } else {
      p_w_H2O <- calculate_p_H2O(T_w)
      p_dp <- calculate_p_dp(p_w_H2O, T_d[index], T_w)
      p_d_H2O <- calculate_p_H2O(T_d[index])

      if (p_dp < 0) {
        RH <- c(RH, "")
      } else {
        
        RH <- c(RH, p_dp / p_d_H2O)
      }
      
    }
    
  }

  return(RH)
}

RH_T <- data.frame(T_d)
librarian::shelf("dplyr")

for (index in delta_T) {
  RH <- calculate_RH_from_delta_T(T_d = T_d, delta_T = index)
  RH_numeric <- as.numeric(RH)
  RH_T <- cbind(RH_T, ifelse(is.na(RH_numeric), "", round(RH_numeric * 100, digits = 1)))
}

colnames(RH_T) <- c(
  "$\\frac{T}{\\unit{\\kelvin}}$",
  delta_T
)

header_text <- c("Kuiva termomeetri näit", paste("Kuiva ja märja termomeetri näitude vahe $\\\\frac{\\\\Delta(T)}{\\\\unit{\\\\kelvin}}$"))
header_span <- c(1, 19)
header <- data.frame(header_text, header_span)

print_table(
  RH_T,
  caption = "Psühhomeetri tabel: sisuosas on esitatud suhteline õhuniiskus protsentides.",
  digits = 5,
  additional_header = header
) %>%
  column_spec(1, width = "6em") %>%
  landscape()

```

niiskuse suhe
: proovis oleva veeauru massi ja kuiva õhu massi suhe

dew point water on glass kim wilde

```{=tex}
\begin{align}
W := \frac{m(\ce{H_2O})}{m(\text{air})} =
\end{align}
``` 

<!--chapter:end:rules.Rmd-->

# Teooria

Kui õhk oleks täiesti kuiv, siis see tähendaks, et selles puuduks veeaur. Kui õhk on täiesti märk, siis tähendab, et see on veeaurust nii küllastunud, et õhku või sellega kokkupuutes olevale õhust jahedamale pinnale tekivad tilgad. Absoluutne õhuniiskus tähendab, kui palju absoluutarvuliselt on õhus veeauru. Suhteline õhuniiskus tähendab, kui palju on õhus veeauru suhteliselt. Eelnevas kuiva õhu näites on õhus veeauru 0, täiesti märjas ehk veeaurust küllastunud õhus 1.

Joonisel \@ref(fig:relative-humidity) on näidatud, kuidas suhteline õhuniiskus ja õhutemperatuur on omavahel seotud. Kuum õhk mahutab rohkem veeauru kui jahe õhk, sest selles on õhu osakesed üksteisest kaugemal ja rohkem on ruumi veeauru osakeste jaoks nende vahel. Seega, kui veeauru kogus õhus on muutumatu, on veeauru kuumas õhus suhteliselt vähem kui jahedas õhus. Kui veeauru on õhus 1, siis on õhk veeaurust küllastunud ja sellesse rohkem veeauru ei mahu, mis tähendab, et edasine õhu jahtumine toob kaasa veeauru kondenseerumise. Olek, milles õhk on veeaurust küllastunud, on seega kastepunkt.

(ref:relative-humidity) @news_september

```{r label = "relative-humidity", fig.cap = "Suhtelise õhuniiskuse ja õhu temperatuuri seos ((ref:relative-humidity)).", fig.margin = TRUE}
include_svg("relative-humidity.webp")
```

Õhuniiskust saab mõõta psühromeetriga. Viimases on kaks termomeetrit: üks kuiva, teine niiske õhu jaoks. Kuiva õhu termomeetri näitu ei manipuleerita. Küll aga tehakse niiskeks teise termomeetri sensor, misjärel hakkab selle termomeetri näit vähenema, sest see niiskus aurub ja aurumisel võetakse ümbritsevast keskkonnast soojusenergiat, mistõttu ümbritsev keskkond jahtub. See jahtumine toimub siiski ainult selle termomeetri sensori ümber ja ei mõjuta teise termomeetri sensori ümbrust. Niiske termomeetri näit langeb, kuni see enam langeda ei saa, st on saavutatud olek, milles edasine aurumine ja kondenseerumine üksteist tasakaalustavad - on jõutud kastepunktini. Kummagi termomeetri näidu erinevuse järgi saab Carrieri psühromeetriliselt diagrammilt \@ref(fig:psychrometric-diagram) vaadata õhuniiskuse, sest eri temperatuuril on õhu võime endasse veeauru mahutada erinev ja need väärtused on katseliselt välja arvutatud.

(ref:psychrometric-chart) @psychrometric-chart

```{r label = "psychrometric-diagram", fig.cap = "Psühromeetriline diagramm ((ref:psychrometric-chart)).", fig.margin = TRUE, out.extra = 'angle=270', out.width = '.96\\textheight'}
include_svg("0000Psych11x17US_SI_logos.pdf")
```

Absoluutse niiskuse arvutamiseks on juhendis valem

```{=tex}
\begin{align}
a := \gamma_\text{w} \cdot 10^3 - 0.64 \cdot (t_\text{d} - t_\text{w}).
(\#eq:a)
\end{align}
```

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\frac{M}{L^3} - \Theta,
(\#eq:dimensional-analysis-for-a)
\end{align}
```

millest lähtuvalt on ühik $\unit{\gram\per\cubic\meter} - \unit{\kelvin}$.

Valemit \@ref(eq:a) kasutatakse juhendis suhtelise niiskuse arvutamiseks:

```{=tex}
\begin{align}
RH := \frac{a}{\gamma_\text{d} \cdot 10^3}.
(\#eq:rh-in-instructions)
\end{align}
```

Dimensionaalanalüüs:

```{=tex}
\begin{align}
\frac{\frac{M}{L^3} - \Theta}{\frac{M}{L^3}} = 1 - \frac{\Theta}{\frac{M}{L^3}} = \frac{\Theta}{\frac{M}{L^3}},
(\#eq:dimensional-analysis-for-rh-in-instructions)
\end{align}
```

millest lähtuvalt on ühik $\unit{\kelvin\per\gram\per\cubic\meter}$.

<!--chapter:end:theory.Rmd-->

# Praktika

## Augusti psühromeetriga õhuniiskuse määramine

Augusti ehk märk-kuiv-psühromeeter koosneb kahest termomeetrist, millest üks on vett imava materjaliga ühendatud veeanumaga (joonis \@ref(fig:wet-dry-psychrometer)). Selle veeanumasse lisasime ümbritseva keskkonna temperatuuril destilleeritud vett ja ootasime, kuni veeanumaga vett imava materjali kaudu ühendatud termomeetri näit langes. Et see kiiremini langeks, lehvitasime papitükiga selle alumise otsa peale, mille ümber oli vett imav materjal, tuult. Kui näidu langemine lõppes, märkisime mõlema termomeetri näidu tabelisse \@ref(tab:data-analysis).

(ref:psychrometer) @psychrometer

```{r label = "wet-dry-psychrometer", fig.cap = "Märg-kuiv-psühromeeter ((ref:psychrometer)).", fig.align = "center", out.height = "96%"}
include_svg("wet-dry-psychrometer.svg")
```

## Aspiratsioonpsühromeetriga õhuniiskuse määramine

Aspiratsioonpsühromeeter on kujutatud pildil \@ref(fig:aspiration-psychrometer). Aspiratsioonpsühromeeter, nagu nimetuseski, n-ö hingab [@aspirationspsychrometer]. 

(ref:aspiration) @aspiration

```{r label = "aspiration-psychrometer", fig.cap = "Aspiratsioonpsühromeeter ((ref:aspiration)).", fig.align = "center", fig.fullheight=TRUE, out.height="96%"}
include_svg("Aspirations-Psychrometer-Fotomontage-65434-LRV1_3000px_2048x2048.svg")
```

Selles on kaks termomeetrit, millest üks on ühendatud niiskust imava jupiga. Kumb termomeeter ühendada, on vabalt valida. Üks jäetakse kuivtermomeetriks ja teine võetakse märgtermomeetriks. Materjal, mis imab vett, nt riidetükk keritakse ümber ühe termomeetri alumise otsa nagu näidatud pildil \@ref(fig:aspiration-psychrometer-installing-batist).

(ref:aspiration-psychrometer-installing-batist) @aspiration_psychrometer_ru

```{r label = "aspiration-psychrometer-installing-batist", fig.cap = "Aspiratsioonpsühromeetrisse batisti paigaldamine ((ref:aspiration-psychrometer-installing-batist)).", fig.margin = TRUE}
include_svg("aspiration-psychrometer-installing-batist.png")
```

Termomeetri ülaosas on ventilaator, mis tirib õhku läbi mõlema termomeetri toru, mis soodustab aurustumist, mida on vaja niiske otsaga termomeetri jaoks. Kui mõlemast läbi ei tõmbaks, siis oleksid tingimused kummagi termomeetri jaoks erinevad ja me ei saaks näite võrrelda. meie ei kasutanud pildil \@ref(fig:aspiration-psychrometer) olevat 2600 eurot maksvat seadet, vaid meil oli kasutuses selline psühromeeter, mis töötab elektri jõul, nii et pole vaja ise lehvitada, puhuda ega keerutada, samuti mitte vedru üles keerata.

Paigaldasime Assmanni aspiratsioonpsühromeetri ühe termomeetri alumise otsa ümber vett imava materjali, mille olime eelnevalt ümbritseva keskkonna temperatuuril oleva destilleeritud veega märjaks teinud, ja lülitasime seadme sisse. Ootasime, kuni niiske otsaga termomeetri näit vähenes. Teoreetiliselt vähenes ka kuivtermomeetri näit, sest õhku tõmmati ka selle otsa juurest läbi. Kui niiske otsaga termomeetri näit enam ei vähenenud, tegime kindlaks kummagi termomeetri näidu ja kandsime tabelisse \@ref(tab:data-analysis).

## Õhu niiskuskarakteristikue määramine *Pasco* limasensoriga

<!--chapter:end:practice.Rmd-->

# Andmeanalüüs

Arvutustes kasutan rõhuna standardset atmosfääri, et tulemused oleksid võrreldavad graafikuga \@ref(fig:psychrometric-diagram).

```{r label = "data-analysis"}
method <- c(
  "Augusti psühhomeeter",
  "Assmanni psühhomeeter",
  "Pasco
ilmajaama
andmete järgi
niiskuse
karakteristikud"
)

t_d <- c(24, 24.6, 26.3)
SetUnitSystem("SI")
T_d <- GetTKelvinFromTCelsius(t_d)
RH_Pasco <- 30.8e-2
t_w_Pasco <- GetTWetBulbFromRelHum(t_d[3], RH_Pasco, p_at)
t_w <- c(16.5, 15.2, t_w_Pasco)
T_w <- GetTKelvinFromTCelsius(t_w)
p_w_H2O <- calculate_p_H2O(T_w)
gamma_w <- calculate_gamma_H2O(p_w_H2O, T_w)
p_dp <- calculate_p_dp(p_w_H2O, t_d, t_w)
gamma_d <- calculate_gamma_H2O(calculate_p_H2O(T_d), T_d)
a <- gamma_w * 1e3 - .64 * (t_d - t_w)
p_d_H2O <- calculate_p_H2O(T_d)
RH <- calculate_RH(p_dp, p_d_H2O)
RH_according_to_instructions <- a / (gamma_d * 1e3) * 100
RH_psychrolib <- GetRelHumFromTWetBulb(t_d, t_w, p_at)

psychrometry <- data.frame(
  method,
  t_d,
  T_d,
  gamma_d,
  t_w,
  T_w,
  a,
  gamma_w,
  p_dp,
  RH,
  RH_according_to_instructions,
  RH_psychrolib
)

colnames(psychrometry) = c(
  "Meetod või sensor",
  "$\\frac{t_\\text{d}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{T_\\text{d}}{\\unit{\\kelvin}}$",
  "$\\frac{\\gamma_\\text{d}}{\\unit{\\kilogram\\per\\cubic\\meter}}$",
  "$\\frac{t_\\text{w}}{\\unit{\\degreeCelsius}}$",
  "$\\frac{T_\\text{w}}{\\unit{\\kelvin}}$",
  "$\\frac{a}{\\unit{\\gram\\per\\cubic\\meter} - \\unit{\\degreeCelsius}}$",
  "$\\frac{\\gamma_\\text{w}}{\\unit{\\kilogram\\per\\cubic\\meter}}$",
  "$\\frac{p_\\text{dp}(\\ce{H_2O})}{\\unit{\\Pa}}$",
  "$RH$",
  "Vastavalt juhendile $\\frac{RH}{\\unit{\\percent}}$",
  "Vastavalt \"psychrolib\"ile $RH$"
)


print_table(
  psychrometry,
  caption = "Suhtelise niiskuse arvutamise sisend- ja väljundandmed, milles $w$ tähendab märga ja $d$ kuiva keskkonda ning $dp$ kastepunkti.",
  digits = 5
) %>%
  column_spec(1, width = "6em") %>%
  column_spec(11, width = "5em") %>%
  column_spec(12, width = "5em") %>%
  landscape()

librarian::shelf("psychrolib")
# psychometrics <- CalcPsychrometricsFromTWetBulb(t, t1, p_at)
# print(psychometrics)
# GetDegreeOfSaturation(t, psychometrics$HumRatio, p_at)
GetDryAirVolume(t, p_at)
# GetMoistAirDensity(t, psychometrics$HumRatio, p_at)
# GetMoistAirVolume(t, psychometrics$HumRatio, p_at)
GetSatVapPres(t)
GetStandardAtmPressure(10)
GetStationPressure(p_at, 10, t)
# GetVaporPressureDeficit(t, psychometrics$HumRatio, p_at)
# GetVapPresFromHumRatio(psychometrics$HumRatio, p_at)
# > 1/69.006*1000-.64*(24-16.5)
# [1] 9.691493
# > 9.691493/(1/45.863*1000)
# [1] 0.4444809
# > .5/755*1013.25
# [1] 0.6710265
librarian::shelf("MeTo")
psyc_cons(elev = 2, P = 101.3)
# > -5.8002206e3/(24+273.15) + 1.3914993e0 - 4.8640239e-2*(24+273.15) + 4.1764768e-5*(24+273.15)^2 - 1.4452093e-8*(24+273.15)^3 + 6.5459673e0*log((24+273.15))
# [1] 8.001398
# > exp(1)^8.001398
# [1] 2985.128
# > 2985.128*.018/8.314472/(24+273.15)
# [1] 0.02174829

```

```{r label = "dp"}
t_dp_Pasco <- 6.8
T_dp_Pasco <- GetTKelvinFromTCelsius(t_dp_Pasco)
p_dp <- calculate_p_H2O(T_dp_Pasco)
p_d <- calculate_p_H2O(GetTKelvinFromTCelsius(t_d[3]))
RH <- calculate_RH(p_dp, p_d)
t_dp_r <- 5.9
T_dp_r <- GetTKelvinFromTCelsius(t_dp_r)
```

Pasco ilmajaamaga väljamõõdetud kastepunkt oli $\qty{`r t_dp_Pasco`}{\degreeCelsius}$ ehk  $\qty{`r T_dp_Pasco`}{\kelvin}$. Selle kaudu arvutatud õhuniiskus oli  `r RH`.

Katseliselt mõõtsime kastepunktiks $\qty{`r t_dp_r`}{\degreeCelsius}$ ehk  $\qty{`r T_dp_r`}{\kelvin}$.

<!--chapter:end:data-analysis.Rmd-->

\onecolumn

```{=html}
<!--
The bib chunk below must go last in this document according to how R Markdown renders.  More info is at http://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html
-->
```
```{=html}
<!-- 
If you'd like to change the name of the bibliography to something else,
delete "References" and replace it.
-->
```
# Kasutatud allikad {.unnumbered}

\hyphenpenalty=10000

```{=html}
<!--
This manually sets the header for this unnumbered chapter.
-->
```
\markboth{References}{References}

```{=html}
<!--
To remove the indentation of the first entry.
-->
```
\noindent

\setlength{\parindent}{-0.20in}

<!--chapter:end:99-references.Rmd-->

